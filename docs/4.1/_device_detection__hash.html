<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Pipeline Documentation: Hash</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png"/></a>
  <span class="c-tagline">51Degrees Pipeline Documentation
   &#160;<span id="projectnumber">4.1</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
     <div class="g-search">
    <div class="c-search is-openable">
    <form class="c-search__form">
      <div id="MSearchBox" class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img id="MSearchSelect" src="icon-search.svg" class="b-icon" alt="Search" 
                 onmouseover="return searchBox.OnSearchSelectShow()"
                 onmouseout="return searchBox.OnSearchSelectHide()"/>
        <input type="text" id="MSearchField" autocomplete="off" class="c-search__input" id="inputSearch" placeholder="Type a class, namespace etc." aria-label="Search"
                 onfocus="searchBox.OnSearchFieldFocus(true)" 
                 onblur="searchBox.OnSearchFieldFocus(false)" 
                 onkeyup="searchBox.OnSearchFieldChange(event)">
         <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
      </div>
    </form>
  </div>
</div>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_device_detection__hash.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__index.html">Device Detection</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__hash.html">Hash</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Hash </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p>Whilst <a class="el" href="_device_detection__pattern.html">Pattern</a>, our original device detection algorithm, is very fast, accurate and continues to be fully supported, 51Degrees are continually looking for any improvements that might be achieved.</p>
<p>During extensive analysis of hundreds of billions of web interactions over several years, we discovered that a smart method of identifying and hashing sub strings within User-Agents could be used to produce an optimum data set that displays the following characteristics:</p>
<ul>
<li>Speed : extremely fast performance with over 1 million detections per second per CPU core possible.</li>
<li>Low Memory : memory overhead is reduced due to the use of hash values rather than the characters of the sub strings.</li>
<li>Prediction : reasonable predictive capabilities when compared to a classic character based trie.</li>
</ul>
<p>51Degrees <b>Hash</b> embodies these features, and the algorithm is subject to an EU Patent (EP3438848) with a US Patent also pending, making this superior method of detection unique to 51Degrees.</p>
<h1 class="g-docs__section-heading">Data Structure</h1>
<p>The exact structure of the data is optimized at the time of the data file's production. By aiming for the lowest possible number of operations needed to get a match, the data file is not only small, it is very fast. Pre-processing steps ensure that the ordering of nodes, and the sub strings used, are carefully calibrated to result in device matches being achieved in as few CPU cycles as possible.</p>
<p>As a result of using hashes and selecting only the important sub strings, the data structure is not only fast, it is small. For all but the shortest sub strings, a hash code will take up far less space than the string itself. In addition, by omitting irrelevant parts of a User-Agent, such as strings which identify the user or location, the size can be reduced, and operations which yield no benefit are removed.</p>
<h1 class="g-docs__section-heading">Detection Process</h1>
<p>A series of nodes arranged in a tree (or trie) are evaluated from root to leaf. Each root or branch node can contain one or more hash values that occur between a given range of character positions. The characters in the target User-Agent are evaluated against the node to either match one of the hash values or not. If a hash value is matched then the corresponding next match node is evaluated. If none of the hash values match then an unmatched node is evaluated. This process continues until a leaf node is reached and the device identified. Consider the following User-Agent.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">      0                   1                   2                   3                   4                   5</div><div class="c-code__line">Col   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9</div><div class="c-code__line">Row                                                                                                                          </div><div class="c-code__line">0     M o z i l l a / 5 . 0   ( L i n u x ;   U ;   A n d r o i d 4 . 0 . 4 ;   e n - u s ;   S P H - D 7 1 0   B u i l d / I</div><div class="c-code__line">1     M M 7 6 I )   A p p l e W e b K i t / 5 3 4 . 3 0   ( K H T M L ,   l i k e   G e c k o )   V e r s i o n / 4 . 0   M o</div><div class="c-code__line">2     b i l e   S a f a r i / 5 3 4 . 3 0</div></div><p><em>Example User-Agent for analysis with Hash</em></p>
<p>The root node of the Hash could contain hash values for the top 50 User-Agents prefixes'. One such prefix could be <code>Mozilla/5.0 (Linux; U; Android 4.0.4;</code> between character positions 0 and 35. By matching this substring using a hash value the possible devices that can be returned are immediately reduced considerably in one operation. As the hash value is only 4 bytes in length the space needed to store the substring is considerably smaller than using the full 36 characters. The evaluation of the operation is also quicker when using hashes than the characters. Hash collisions can be avoided by identifying them during the production of the data set at 51Degrees and choosing substrings that do not result in collisions.</p>
<p>Continuing the above example, the branch node that follows the matched prefix may then focus on identifying the hardware device by choosing substrings starting at character position 44. Many Android User-Agents will consistently place the substrings associated with the device at this position. A long list of hash values, perhaps tens of thousands, could then be evaluated to either identify the device or narrow down the options. Perhaps just the first 5 characters <code>SPH-D</code> will be used to reduce the possible devices. This is very efficient as it considerably narrows the possible devices with a single hash value calculation and lookup. This process of hashing the most relevant substrings will continue until a complete device including hardware, operating system and browser has been identified.</p>
<p>The production of the optimized data set is extremely computationally intensive, requiring multiple servers to work for several hours. However the resulting data set is small and fast for 51Degrees users. As only the relevant characters are evaluated and some tolerance for substrings drifting within the User-Agent can be allowed for, the predictive features of <b>Hash</b> are better than character based trie solutions.</p>
<h1 class="g-docs__section-heading">Predictive Power<a class="anchor" id="DeviceDetection_Hash_PredictivePower"></a></h1>
<p>The <b>Hash</b> algorithm has two tolerances which can be enabled through the API to enhance the predictive power of the algorithm. Predictive power of a matching algorithm can be measured by how accurately it can match things it has not yet encountered based solely on the information it already has. By ignoring irrelevant sub strings, the <b>Hash</b> algorithm already fairs well when matching unknown User-Agents. But by configuring drift and difference, the predictive power can be fine tuned by the user.</p>
<h2>Drift</h2>
<p>The drift tolerance allows for a substring to be matched in a wider range of character positions. As an example, the User-Agent may be altered by inserting a space near the start of the string. If we require the characters to be in the exact expected positions then this could match as something other than we might expect.</p>
<p>To allow for drift in sub strings within a User-Agent, the drift tolerance can be set. In the case of the above example, setting the drift to one would mean that even though the whole User-Agent was shifted by one character position, it would be matched as the original User-Agent.</p>
<p>This feature can also be useful in predicting new devices which have not yet been seen in the wild. For example, if a User-Agent containing the sub string <code>iPhone 8</code> was known, then along came one containing the sub string <code>iPhone 8s</code>, all sub strings to the right of this would be shifted by one character. Setting the drift allows the Browser and OS to be correctly identified even though the sub strings used to identify them are not in the position they are expected to be in.</p>
<h2>Difference</h2>
<p>The difference tolerance allows for User-Agents where some characters differ slightly from what is expected. For example, if a new Android version is released that is not contained in the data set, it can be identified.</p>
<p>Take the example User-Agent for a known browser version which contains the sub string <code>Android 4.0.4</code>, and an unknown version containing the sub string <code>Android 4.0.5</code>. Due to the nature of the chosen <b>hash</b> algorithm, the hashes of the two sub strings vary proportionally to the difference in ASCII value of the last character. This means that if the difference is set to one, the unknown sub string will be allowed as a match for the known Android version. </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
