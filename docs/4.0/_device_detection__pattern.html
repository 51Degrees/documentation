<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Documentation: Pattern</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png"/></a>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname" class="b-text--heading-4">Documentation
   &#160;<span id="projectnumber">4.0</span>
   </div>
  </div>
  <div id="main-nav"></div>
     <div class="c-search is-openable">
  <form class="c-search__form">
    <div id="MSearchBox" class="b-form-group b-form-group--with-icon">
      <label for="inputSearch" class="b-text--hidden">Search</label>
      <img id="MSearchSelect" src="../images/icon-search.svg" class="b-icon" alt="Search" 
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"/>
      <input type="text" id="MSearchField" autocomplete="off" class="c-search__input" id="inputSearch" placeholder="Type a class, namespace etc." aria-label="Search"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)">
       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
    </div>
  </form>
</div>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_device_detection__pattern.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__index.html">Device Detection</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__pattern.html">Pattern</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Pattern </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Detection Process</h1>
<p>With the Pattern method, User-Agent (UA) is the main HTTP header used to identify the requesting device. The device data file contains signatures which consist of the relevant characters of the User-Agent. Only the segments of the UA considered applicable to device detection are stored, characters which are not deemed necessary are omitted in order to reduce the size of the data file. For this reason detection results will rarely contain an entire User-Agent for the device returned.</p>
<p>The <a href="https://51degrees.com/resources/user-agent-tester">51Degrees User-Agent Tester</a> can be used to show the relevant segments for a given User-Agent.</p>
<p>Below, we will step through a number of User-Agent scenarios to illustrate the different ways in which the <b>pattern</b> method identifies a match.</p>
<h2>Exact Match</h2>
<p>Consider the following User-Agent for the Nexus 7 running Android 4.3 and Chrome 29.</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316/Products/DeviceData/UserAgentTester/Default.aspx?useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+Nexus+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(KHTML%2c+like+Gecko)+Chrome%2f29.0.1547.72+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.72 Safari/537.36</code></a></p>
<p>When provided to the device detection routines the following sub strings relate exactly to the returned device information.</p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/        AppleWebKit/</div><div class="c-code__line">(KHTML, like Gecko) Chrome/29           Safari/537</div></div><p> <b>Rank</b> 60057</p>
<p><b>Difference</b> 0</p>
<p><b>Method</b> Exact</p>
<p>Those characters not relevant to the matching process could be changed and the same result returned. For example, the following User-Agent has the string "AAAAAA" in place of the characters "JSS15Q" which follow the "Build/" string.</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316Products/DeviceData/UserAgentTester//TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+Nexus+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(Opera+Mobi%2c+Gecko)+Chrome%2f29.0.1547.72+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/AAAAAA) AppleWebKit/537.36 (Opera Mobi, Gecko) Chrome/29.0.1547.72 Safari/537.36</code></a></p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3  Nexus 7 Build/        AppleWebKit              </div><div class="c-code__line">             Gecko) Chrome/29           Safari/537</div></div><p> <b>Rank</b> 60057</p>
<p><b>Difference</b> 0</p>
<p><b>Method</b> Exact</p>
<p>This revised User-Agent returns exactly the same device details as the original because the detection algorithm knows the presence of “AAAAAA” at these character positions is unimportant. Knowledge of the positions of relevant sub strings improves performance and accuracy as irrelevant characters do not provide distractions.</p>
<p>In contrast, regular expression based solutions often suffer from considering these unimportant characters when determining the details of the device.</p>
<h2>Additional Matching Methods</h2>
<p>Three different methods can be used to find a match for a User-Agent, the most commonly used is the <b>Exact</b> match as shown in the example above.</p>
<p>The method used to obtain the match is provided in all detection results along with a difference indicator. The difference value will always be zero when the Exact method has been used, as a precise match has been obtained against the signatures held in the data file and there is no difference between them.</p>
<p>If an Exact match cannot be found then a small subset of possible results will be searched using the following methods in turn. If a method finds a match the results will be returned and further methods not attempted.</p>
<h3>Nearest</h3>
<p>Sometimes relevant sub strings may have been moved when irrelevant characters are added elsewhere in the User-Agent. The following User-Agent has an additional X character placed after the full version of Chrome. All subsequent characters that might be relevant are now moved 1 character position to the right of where the algorithm would expect to find them.</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+Nexus+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(KHTML%2c+like+Gecko)+Chrome%2f29.0.1547.72X+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.72X Safari/537.36</code></a></p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3  Nexus 7 Build/        AppleWebKit/              </div><div class="c-code__line">(KHTML, like Gecko) Chrome/29            Safari/537</div></div><p> <b>Rank</b> 60057</p>
<p><b>Difference</b> 1</p>
<p><b>Method</b> Nearest</p>
<p>The correct device is returned but the fact that the relevant sub strings are not in exactly the same position as the matched signature can be determined via the match method and the difference values.</p>
<p>In this case the method used was <b>Nearest</b> indicating that all the relevant sub strings were present but not at the expected character positions. The variance in character positions is 1 as indicated in the difference value.</p>
<p>If an older data file is being used for device detection the <b>Nearest</b> method will be used more often as subtle differences are observed between the older data in the file and the format of current User-Agents.</p>
<h3>Closest</h3>
<p>If the previous methods fail to detect the device, the <b>Closest</b> method is used. This method finds the device signature that most closely matches as many of the relevant sub strings as possible. For the majority of genuine UAs it will always return a result, although the difference value may be very high.</p>
<p>Consider the following User-Agent where the Chrome version has been set to 10:</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316Products/DeviceData/UserAgentTester//TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+Nexus+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(KHTML%2c+like+Gecko)+Chrome%2f51.0.1547.72+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/10.0.1547.72 Safari/537.36</code></a></p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/        AppleWebKit/              </div><div class="c-code__line">(KHTML, like Gecko) Chrome/28           Safari/537</div></div><p> <b>Rank</b> 59047</p>
<p><b>Difference</b> 18</p>
<p><b>Method</b> Closest</p>
<p>The closest Chrome version in the file being used is 28. Therefore, this is the version that matches and the difference is set to 18. This approach ensures that the most appropriate detection result is returned even when the device data does not know about the most recent versions of devices.</p>
<p>In contrast, regular expression or tree structure based detection methods are usually unable to distinguish between the numeric differences in relevant sub strings and therefore become susceptible to accuracy problems.</p>
<p>A further example can be seen in this User-Agent where the u in Nexus has been changed to an i. The Nexus 7 is returned correctly but the difference score is 120.</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316Products/DeviceData/UserAgentTester/TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+Nexis+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(KHTML%2c+like+Gecko)+Chrome%2f29.0.1547.72+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; Nexis 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.72 Safari/537.36</code></a></p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3; Nexus 7 Build/        AppleWebKit/              </div><div class="c-code__line">(KHTML, like Gecko) Chrome/29           Safari/537       </div></div><p> <b>Rank</b> 60057</p>
<p><b>Difference</b> 120</p>
<p><b>Method</b> Closest</p>
<p>The numeric difference between the <a href="http://www.asciitable.com/">ASCII characters</a> i (ASCII value = 105) and u (ASCII value = 117) is 12. This is then multiplied by 10 to give the difference value of 120. The difference is multiplied by 10 as this method is the least accurate.</p>
<p>The difference in the character lengths of the closest sub strings and the target User-Agent is also a factor in the calculation of difference.</p>
<p>In our final example using a 'closest' match, the string "Nexus" has been replaced entirely by "iPhone". A Nexus device is still returned but the difference value is very high, indicating the result should be considered unreliable.</p>
<p><b>Target UserAgent</b></p>
<p><a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316Products/DeviceData/UserAgentTester/TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=Mozilla%2f5.0+(Linux%3b+Android+4.3%3b+iPhone+7+Build%2fJSS15Q)+AppleWebKit%2f537.36+(KHTML%2c+like+Gecko)+Chrome%2f29.0.1547.72+Safari%2f537.36"><code>Mozilla/5.0 (Linux; Android 4.3; iPhone 7 Build/JSS15Q) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/29.0.1547.72 Safari/537.36</code></a></p>
<p><b>Closest Sub Strings</b> </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Mozilla/5.0 (Linux; Android 4.3; Nexus 10 Build/        AppleWebKit/             </div><div class="c-code__line">                    Chrome/29           Safari/537</div></div><p> <b>Rank</b> 60897</p>
<p><b>Difference</b> 1510</p>
<p><b>Method</b> Closest</p>
<p>Tree structures and regular expression solutions can not provide this level of intelligence concerning the validity of the result where unusual target User-Agents are encountered.</p>
<h3>None</h3>
<p>Finally if none of the previous methods have resulted in a match, usually because the User-Agent is a random collection of characters, the None method will be returned.</p>
<p><b>Target UserAgent</b> <a href="https://51degrees.com/Products/DeviceData/UserAgentTester/tabid/316Products/DeviceData/UserAgentTester/TabId/316/Products/DeviceData/Default.aspx?UserAgentTester=Default.aspx&amp;useragent=2sadsa%$^dfs"><code>2sadsa%$^dfs</code></a></p>
<p><b>Relevant Sub Strings</b></p>
<p><b>Difference</b> 0</p>
<p><b>Method</b> None</p>
<p>The default Desktop device profile will be used to populate device data when the none match method is used.</p>
<h1 class="g-docs__section-heading">Modes of operation</h1>
<p>Some of our APIs , for example, Java and .NET, provide two modes of operation when working with Pattern algorithms.</p>
<p><b>Stream mode</b> is very memory efficient as it only loads the necessary data file headers and locations of various entities within the file. Device detection will rely on retrieving information from the data file for most detections (If cache is used not every detection will result in reading from the data file). Using a data file with a stream provider locks the file for write access.</p>
<p><b>Memory mode</b> loads the entire data file into main memory. This is faster than stream mode but requires considerably more memory and does not use cache. Device detection will retrieve data directly from memory. Once initialized there should be no further read requests for the data file.</p>
<h1 class="g-docs__section-heading">Summary</h1>
<p>This page provides an overview of the pattern detection methods, the three matching methods available, and how to use the difference and match method indicators to understand the validity of the result. The source code used to implement the algorithms is licensed under the Mozilla Public License 2 and is available for inspection. As such we encourage those that would like to know more about pattern detection to explore the source code and comments contained within it.</p>
<p>51Degrees also provide a <a class="el" href="_device_detection__hash.html">Hash</a> device detection method which is much faster than Pattern at the expense of being less able to cope with non-exact matches. </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated on Thu Nov 7 2019 15:15:51 for Documentation by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
