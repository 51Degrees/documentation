name: Generate Documentation Preview

on:
  pull_request:
    
jobs:
  # Generate documentation for all API repositories
  Generate_API_Documentation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup PowerShell
        run: |
          sudo apt-get update
          sudo apt-get install -y powershell
          
      - name: Generate Documentation
        run: |
          # Run our custom script to generate documentation for all API repos
          pwsh ./ci/generate-documentation.ps1 -Version "4.5" -GitHubToken ${{ secrets.ACCESS_TOKEN }} -GenerateOnly
          
      - name: Upload Documentation
        uses: actions/upload-artifact@v4
        with:
          name: documentation
          path: 4.5/
          
      - name: Comment PR with artifact link
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.ACCESS_TOKEN }}
          script: |
            const artifactUrl = `https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}#artifacts`;
            const comment = `ðŸ“š **Documentation Preview Generated**
            You can download the documentation artifact here:
            ðŸ”— [Download Documentation Artifact](${artifactUrl})`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
