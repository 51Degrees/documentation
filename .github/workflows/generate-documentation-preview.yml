name: Generate Documentation Preview

on:
  pull_request:
    
jobs:
  # Generate documentation for all API repositories
  Generate_API_Documentation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup PowerShell
        run: |
          sudo apt-get update
          sudo apt-get install -y powershell
          
      - name: Generate API Documentation
        run: |
          # Run our custom script to generate documentation for all API repos
          pwsh ./ci/generate-documentation.ps1 -Version "4.5"
          
      - name: Upload API Documentation
        uses: actions/upload-artifact@v3
        with:
          name: api-documentation
          path: 4.5/apis/
          
  # Run the common workflow on each pull request
  Generate_Documentation_Preview:
    needs: Generate_API_Documentation
    uses: 51Degrees/common-ci/.github/workflows/generate-documentation-preview.yml@main
    with:
      repo-name: ${{ github.event.repository.name }}
      pull-request-id: ${{ github.event.number }}
    secrets: 
      token: ${{ secrets.ACCESS_TOKEN }}
