<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Error Handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_pipeline_api__features__error_handling.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__index.html">Pipeline API</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__index.html">API Features</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__error_handling.html">Error Handling</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Error Handling </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p>The <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> can contain and number or configuration of <a class="el" href="_pipeline_api__concepts__flow_elements__flow_element.html">flow elements</a>, including custom third-party ones. As such, it must have a robust and consistent error handling solution.</p>
<p>See the <a href="https://github.com/51Degrees/specifications/blob/main/pipeline-specification/features/exception-handling.md#">Specification</a> for more technical details.</p>
<h1 class="g-docs__section-heading">Approach</h1>
<p>Almost all languages have <code>try/catch</code> constructs, so these are used by the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> code when calling functions on flow elements.</p>
<p>If the flow element code raises an error, it will be handled by the catch statement.</p>
<p>Any error that occurs will be logged in the <code>Errors</code> section of the current <a class="el" href="_pipeline_api__concepts__data__flow_data.html">flow data</a>. The pipeline then proceeds to execution of the next <a class="el" href="_pipeline_api__concepts__flow_elements__flow_element.html">flow element</a>.</p>
<p>After all <a class="el" href="_pipeline_api__concepts__flow_elements__flow_element.html">flow elements</a> have completed, there are two possible scenarios, depending on <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> configuration:</p>
<ol type="1">
<li>If the <a class="el" href="_pipeline_api__concepts__data__flow_data.html">flow data</a> contains any errors then an error will be raised using the standard language features.</li>
<li>Execution will return to the caller of the <code>Process</code> function. Any errors will effectively be hidden/suppressed unless <a class="el" href="_pipeline_api__features__logging.html">logging</a> is configured or the <code>Errors</code> section of the <a class="el" href="_pipeline_api__concepts__data__flow_data.html">flow data</a> is checked by the caller.</li>
</ol>
<h1 class="g-docs__section-heading">Configuration</h1>
<p>Error handling is configured using the 'SuppressProcessExceptions' setting. If set to <code>true</code>, errors are hidden/suppressed. If <code>false</code>, an error will be raised at the end of <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> execution.</p>
<p>The default value is <code>false</code>. This is recommended for development/testing to highlight issues.</p>
<p>When running the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> in production, we recommend setting this to <code>true</code> in order to prevent unexpected errors from crashing the application.</p>
<p>As with all configuration settings, this can be set in code or via a <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> configuration file (see <a href="https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/Cloud/Framework-Web/App_Data/51Degrees.json#L41">.NET example</a>).</p>
<h1 class="g-docs__section-heading">Testing the unhappy path scenarios</h1>
<p>In each integration there are dependencies that can fail, such as network connectivity, DNS, load balancers, web servers etc.</p>
<p>This is especially true for scenarios relying on 51Degrees Cloud Service. There are several steps you need to take to ensure your integration is safe against such failures and won't crash in production.</p>
<h2>Simulating the failure</h2>
<p>For Cloud integration there two ways to simulate a 51Degrees Cloud Service dependency failure:</p>
<ol type="1">
<li>Specify a non-existent <code>EndPoint</code> in the <code>CloudRequestEngine</code> configuration in the configuration file. For example, set it to "http://nonexistent.domain/".</li>
<li>Specify <code>127.0.0.1 cloud.51degrees.com</code> in the <code>/etc/hosts</code> file (<code>C:\Windows\System32\drivers\etc\hosts</code> on Windows).</li>
</ol>
<p>Under any of these conditions your server app won't be able to talk to <code>cloud.51degrees.com</code>.</p>
<h2>Testing</h2>
<ol type="1">
<li>Simulate the failure using one of the methods above.</li>
<li>By default <code>SuppressProcessExceptions</code> is <code>false</code>, thus demanding you to first test the behaviors under this setting. Verify that you receive an exception originating in the 51D <code>Pipeline</code> code â€“ it should state that <code>cloud.51degrees.com</code> is not reachable or similar.</li>
<li>Next set <code>SuppressProcessExceptions</code> to <code>true</code> in the configuration and rerun the service. Verify that you don't get an exception from the 51D <code>Pipeline</code> code, but instead it now returns <code>FlowData</code> object with <code>Errors</code>. If you still get some exceptions, check the next step.</li>
<li>Make sure you properly wrap getting the device data in your code from FlowData (<code>FlowData.Get&lt;IDeviceData&gt;()</code> in .NET) as this call may throw an exception (see <a href="https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/Cloud/Framework-Web/Default.aspx#L97">.NET example</a>). Also make sure that you wrap retrieving properties from device data, such as using a function that try-catch-wraps and null-checks the device data and its properties (see <a href="https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/Cloud/Framework-Web/Default.aspx#L111">.NET example</a>).</li>
<li>Finally, undo the failure simulation (either remove the non-existent endpoint from the configuration or comment out the record in the <code>hosts</code> file), and observe the happy path scenario. All should work as expected.</li>
</ol>
<p>Leave the <code>SuppressProcessExceptions</code> configuration set to <code>true</code> for the production setup, as it will protect the users from interruptions in case any of the dependencies fail. </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
