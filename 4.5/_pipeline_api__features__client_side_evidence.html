<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Client-side Evidence</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_pipeline_api__features__client_side_evidence.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__index.html">Pipeline API</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__index.html">API Features</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__client_side_evidence.html">Client-side Evidence</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Client-side Evidence </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p><a class="el" href="_pipeline_api__concepts__data__evidence.html">Evidence</a> will usually be drawn from one of four places:</p>
<ul>
<li>HTTP headers</li>
<li>Cookies</li>
<li>Query parameters</li>
<li>Request metadata such as source IP address</li>
</ul>
<p>Any device making a request to a web site will include some of this information. For example, the User-Agent HTTP header is almost always populated as part of a request. In some cases though, additional <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> providing more detail can be obtained from code running directly on the client device. In some cases, this may even be required. For example, this technique can be used to retrieve the latitude and longitude from devices that have this capability.</p>
<p>See the <a href="https://github.com/51Degrees/specifications/blob/main/pipeline-specification/features/web-integration.md#client-side-features">Specification</a> for more technical details.</p>
<h1 class="g-docs__section-heading">Client-side data</h1>
<p>When using the client-side evidence integration, the first step is for the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> to produce a JSON representation of all the properties that have been populated by <a class="el" href="_pipeline_api__concepts__flow_elements__flow_element.html">flow elements</a>.</p>
<p>Each property may also have some metadata associated with it in the form of another property or attribute. The naming convention of metadata properties is the related property name with a suffix. e.g.,</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;device&quot;: {</div><div class="c-code__line">    &quot;javascript&quot;: &quot;&quot;,</div><div class="c-code__line">    &quot;javascriptdelayexecution&quot;: true</div><div class="c-code__line">}</div></div><p>List of suffixes:</p>
<div class="g-table g-table--overflow"><table class="c-table">
<tr class="c-table__row--heading">
<td class="c-table__cell">Suffix  </td><td class="c-table__cell">Description   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>nullreason</code>  </td><td class="c-table__cell">If the result for a property is null this field will be populated with a reason as to why there is no result.   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>delayexecution</code>  </td><td class="c-table__cell">If this value is true the related property is a JavaScript property and will not run immediately when evaluating the JavaScript Resource.   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>evidenceproperties</code>  </td><td class="c-table__cell">A list of JavaScript properties which need to be evaluated first before this property can be populated.   </td></tr>
</table>
</div><p>This JSON data is sent to the client along with some JavaScript that is used to handle updating that JSON payload with new property values determined from client-side evidence as well as provide easy access to the property values in client-side JavaScript code.</p>
<h1 class="g-docs__section-heading">JavaScript properties</h1>
<p><a class="el" href="_pipeline_api__concepts__meta_data__element_properties.html">Element properties</a> include a 'Type' property that indicates the type of the data represented by the property's values.</p>
<p>JavaScript properties are simply properties that have their Type set to 'JavaScript'. The value of such a property should be a snippet of JavaScript code that, when run on the client device, will obtain some extra values from the device.</p>
<p><a class="el" href="_pipeline_api__concepts__meta_data__element_properties.html">Element properties</a> also include a 'DelayExecution' property which indicates if a 'JavaScript' property should not be executed on the client straight away and a 'EvidenceProperties' property which contains a list of JavaScript properties that, when executed, will obtain additional <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> that can help in determining the value of this property.</p>
<h1 class="g-docs__section-heading">How it works</h1>
<p>The JSON data management JavaScript will check for any properties of type 'JavaScript' and execute them on the client or if the 'DelayExecution' property is set to true then the 'JavaScript' will only be executed in response to some user action. There are then two possible mechanisms to get these extra values back to the server in order for them to be included in the evidence used by the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a>.</p>
<ol type="1">
<li>A background callback to the server yields updated JSON data that replaces the existing JSON payload.</li>
<li>The JavaScript property sets a cookie that is then sent to the server on the next request.</li>
</ol>
<h2>Background callback</h2>
<p>A request is made to the server in the background that includes the extra values as form parameters. The server sends this through the pipeline and the result is packaged as JSON and sent in the response to the client, which will update it's JSON payload data, making the new values available to all client-side code.</p>
<p>Adding this feature to the page may result in data being written to the client device using <code>cookies</code> or <code>sessionStorage</code> for efficiency. Any keys prefixed with <code>51D_</code> are 51Degrees cookies, and any keys prefixed with <code>fod_</code> are sessionStorage items used for efficient evidence handling and data transfer.</p>
<p>This example shows the process flow between client and server.</p>
<p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_client-side-evidence-callback.svg" width="728" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</p>
<h2>Cookies on next request</h2>
<p>When executed, the JavaScript property sets a cookie that is then sent to the server on the next request. The <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> will automatically use these cookies as <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> so that the results it returns take account of the new information.</p>
<p>This example shows the process flow between client and server.</p>
<p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_client-side-evidence.svg" width="587" height="316"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</p>
<h2>Privacy Policy</h2>
<p>If you are using this feature, especially when using the server-side capability to return enriched data, it is your responsibility to consider any updates to your customer privacy policy.</p>
<p><b>This is not legal advice</b>, and you should consult your legal team for guidance.</p>
<p>If you are using the 51Degrees Cloud service, or would like to see an example of how to describe this in your service that incorporates client-side evidence, see our <a href="https://51degrees.com/terms/client-services-privacy-policy">Client Services Policy</a>.</p>
<p>For efficiency, we store limited data in cookies or session storage. Anything prefixed <code>51D_</code> or <code>fod_</code> is related to 51Degrees <b>client-side evidence</b> handling and is used solely for the purpose of enabling this technical feature.</p>
<h2>Storage Mechanism</h2>
<p>By default, when using the 51Degrees Cloud service, values returned from client-side evidence processing are stored using <code>sessionStorage</code>. This avoids setting any cookies unless explicitly required. However, this behaviour can be changed by adding the <code>fod-js-enable-cookies=true</code> query parameter to the Resource Key URL. When set, this instructs the client-side script to use <code>cookies</code> instead of <code>sessionStorage</code> for storing data.</p>
<p>For more details on this parameter and related options, see the <a href="https://cloud.51degrees.com/api-docs/index.html">Cloud API Documentation</a>.</p>
<h1 class="g-docs__section-heading">Web integration</h1>
<p>The <b>client-side evidence</b> feature requires multiple <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> components to operate together. There are <a class="el" href="_pipeline_api__features__web_integration.html">web integration</a> solutions for various web frameworks that handle most of the complexity for you.</p>
<p>These solutions are generally enabled by default but do require some additional configuration in order to function. The implementations vary significantly based on the language and framework, but the core steps will involve the following:</p>
<ul>
<li>Make a change to request the initial JavaScript with JSON payload. For example, by adding a JavaScript include.</li>
<li>If using the <b>background callback</b> mechanism:<ul>
<li>Create an endpoint that can pass requests to the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> and serve the required JSON response. *</li>
<li>Configure the JavaScriptBuilderElement with the URL for your endpoint. *</li>
<li>Add some JavaScript code to update the page content when new JSON data is received.</li>
</ul>
</li>
</ul>
<p>(*) These tasks are handled automatically by the ASP.NET Core, Java MVC and Java Servlet integrations</p>
<p>For more detailed, language-specific steps, see the <a class="el" href="_pipeline_api__examples__web_integration.html">web integration examples</a> or the engine-specific examples such as the <a class="el" href="_device_detection__examples__getting_started__web__index.html">device detection examples</a> or <a class="el" href="_reverse_geocoding__examples__web_integration__examples.html">reverse geocoding examples</a>.</p>
<h1 class="g-docs__section-heading">Static and Quasi-Static Script Approaches</h1>
<h2>Overview</h2>
<p>51Degrees provides multiple ways to integrate device detection using client-side JavaScript evidence collection. The default approach is a dynamic integration scenario, but semi-static and conceptual static methods can also be used depending on implementation constraints.</p>
<h3>Dynamic Scenario (Default)</h3>
<p>In a dynamic integration scenario, the client-side evidence collection script is generated dynamically for each request. This ensures that the JavaScript snippets used for detection are always specific to the client’s device or browser context. A typical integration example: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;script src=&quot;&lt;51degrees.core.js URL&gt;&quot;&gt;&lt;/script&gt;</div></div><p> The <code>src</code> attribute points to a 51Degrees client-side evidence endpoint that dynamically produces the <code>51degrees.core.js</code> script. This script includes JavaScript snippets that perform client-side evidence collection.</p>
<h2>Process Overview</h2>
<h3>Dynamic Generation</h3>
<ul>
<li>The script is generated for every request based on initial evidence (e.g., User-Agent).</li>
<li>JavaScript snippet properties are retrieved from the data file on the server.</li>
<li>The final script differs depending on the detected client type.</li>
</ul>
<h3>Snippet Retrieval and Integration</h3>
<ul>
<li>JavaScript snippet properties are stored within the 51Degrees data file.</li>
<li>The Device Detection Engine retrieves these as part of the detection results.</li>
<li>Example:<ul>
<li>If supplied User-Agent corresponds to an iPhone, the <code>javascripthardwareprofile</code> property contains iPhone-specific code.</li>
<li>If it indicates macOS, the property contains Mac-specific code.</li>
</ul>
</li>
<li>These snippets are updated daily with the data file.</li>
</ul>
<h3>Script Assembly</h3>
<ul>
<li>The <code>JSONBuilderElement</code> and <code>JavaScriptBuilderElement</code> (part of the 51Degrees <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a>) inject the snippet properties into a JavaScript template.</li>
<li>Templates are available at: (<a href="https://github.com/51Degrees/javascript-templates">https://github.com/51Degrees/javascript-templates</a>).</li>
<li>The result is the complete <code>51degrees.core.js</code> script.</li>
</ul>
<h3>Client-Side Execution</h3>
<ul>
<li>The <code>51degrees.core.js</code> script executes each snippet sequentially in the client browser.</li>
<li>Snippets store collected evidence in the session storage (or cookies) using <code>51D_</code> prefixes, for example:<ul>
<li><code>51D_profileIds</code></li>
</ul>
</li>
<li>The collected evidence will be sent to the server as property overrides and also received in the client code in a callback provided to a <code>fod.complete</code> function: <div class="c-code__block c-code__block--outline"><div class="c-code__line">fod.complete(function() {</div><div class="c-code__line">    // Handle collected evidence here</div><div class="c-code__line">});</div></div></li>
</ul>
<h3>Profile Matching</h3>
<ul>
<li>The collected <code>51D_profileIds</code> values must be matched against the same data file used to generate the snippets.</li>
<li>This ensures accurate and consistent device identification.</li>
</ul>
<h2>Semi-Static Scenario</h2>
<p>If your environment already includes a static script (e.g., <code>&lt;script src="&lt;myscript.js URL&gt;"&gt;</code>) and cannot add another dynamically generated one, a semi-static integration approach is recommended. This method merges 51Degrees-generated snippets into your existing script, allowing some dynamic behaviour while maintaining a mostly static setup.</p>
<p>Please note the implementation of this approach is not part of the 51Degrees solution as it involves your custom system, thus you have to implement it yourself - we only give the general outline here.</p>
<h3>Implementation Options</h3>
<h3>Option 1 — Dynamic Merge per Request</h3>
<ul>
<li>Modify your existing script to be generated dynamically on your server.</li>
<li>Pass all HTTP header evidence to the 51Degrees <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> during script generation.</li>
<li>The <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> returns an appropriate version of the snippet (e.g., different for iPhone, iPad, or Mac).</li>
<li>Your script includes that snippet dynamically before returning it to the client.</li>
</ul>
<h3>Option 2 — Cached Variants (Semi-Static)</h3>
<ul>
<li>Pre-generate and cache short-lived variants of the 51Degrees-generated script for device groups (e.g., iPhone, iPad, Mac).</li>
<li>Your script can decide which cached snippet to load based on basic client-side conditions.</li>
<li>Cached variants should be refreshed whenever the data file updates.</li>
<li>Always ensure that <code>51D_profileIds</code> are matched against the same data file from which snippets were derived.</li>
</ul>
<h2>Conceptual Static Approach</h2>
<h3>Implementation Considerations</h3>
<ul>
<li><b>Extraction</b> - Extract relevant JavaScript snippets (for specific device groups such as iPhones) directly from the current 51Degrees data file.</li>
<li><b>Maintenance</b> - Refresh static scripts daily or as frequently as possible to remain synchronized with data file updates.</li>
<li><b>Customization</b> - Implementation details depend on your environment. There is no one-size-fits-all static solution. Stale or outdated static scripts can lead to incorrect device identification.</li>
</ul>
<h3>Comparison Summary</h3>
<div class="g-table g-table--overflow"><table class="c-table">
<tr class="c-table__row--heading">
<td class="c-table__cell">Approach Type  </td><td class="c-table__cell">Script Generation  </td><td class="c-table__cell">Update Frequency  </td><td class="c-table__cell">Typical Use Case   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell">Dynamic (Default)  </td><td class="c-table__cell">Fully dynamic per request  </td><td class="c-table__cell">Real-time  </td><td class="c-table__cell">Standard 51Degrees integration for dynamic or modern sites   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell">Semi-Static  </td><td class="c-table__cell">Cached or merged dynamically  </td><td class="c-table__cell">On data file update  </td><td class="c-table__cell">When dynamic script loading is restricted   </td></tr>
</table>
</div><h3>Best Practices</h3>
<h3>Synchronization</h3>
<ul>
<li>Always ensure that the client-side snippets and server-side data file originate from the same data file version. Mismatched versions can cause inaccurate device matching or inconsistent detection results.</li>
</ul>
<h3>Data File Updates</h3>
<ul>
<li>Refresh your data file and any cached or static snippets daily (or as frequently as your infrastructure allows).</li>
<li>Automate the refresh process wherever possible to prevent stale results.</li>
</ul>
<h3>Caching Strategy</h3>
<ul>
<li>For semi-static scenarios, limit cache lifetime to no longer than the data file update cycle.</li>
<li>If using a CDN, configure cache invalidation or revalidation logic based on the 51Degrees data update frequency.</li>
</ul>
<h3>Version Control</h3>
<ul>
<li>Keep a record of the data file version or timestamp used to generate each JavaScript snippet.</li>
<li>This helps debug inconsistencies between collected evidence and device matching.</li>
</ul>
<h3>Fallback Handling</h3>
<ul>
<li>Implement fallback logic for cases where no <code>51D_profileIds</code> are available (e.g., script blocked, or execution failed).</li>
<li>Fallback can use baseline server-side detection or cached evidence.</li>
</ul>
<h3>Testing</h3>
<ul>
<li>Test across major device types (mobile, tablet, desktop) to ensure snippets behave correctly in different environments.</li>
<li>Validate that the evidence collection keys (e.g., <code>51D_profileIds</code>) are properly populated in storage and transmitted.</li>
</ul>
<h3>Security</h3>
<ul>
<li>Avoid exposing sensitive internal URLs or raw data file paths in the browser.</li>
<li>Serve dynamically generated scripts through your own API gateway or proxy if needed. </li>
</ul>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
