<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Client-side Evidence</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_pipeline_api__features__client_side_evidence.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__index.html">Pipeline API</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__index.html">API Features</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_pipeline_api__features__client_side_evidence.html">Client-side Evidence</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Client-side Evidence </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p><a class="el" href="_pipeline_api__concepts__data__evidence.html">Evidence</a> will usually be drawn from one of four places:</p>
<ul>
<li>HTTP headers</li>
<li>Cookies</li>
<li>Query parameters</li>
<li>Request metadata such as source IP address</li>
</ul>
<p>Any device making a request to a web site will include some of this information. For example, the User-Agent HTTP header is almost always populated as part of a request. In some cases though, additional <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> providing more detail can be obtained from code running directly on the client device. In some cases, this may even be required. For example, this technique can be used to retrieve the latitude and longitude from devices that have this capability.</p>
<p>See the <a href="https://github.com/51Degrees/specifications/blob/main/pipeline-specification/features/web-integration.md#client-side-features">Specification</a> for more technical details.</p>
<h1 class="g-docs__section-heading">Client-side data</h1>
<p>When using the client-side evidence integration, the first step is for the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> to produce a JSON representation of all the properties that have been populated by <a class="el" href="_pipeline_api__concepts__flow_elements__flow_element.html">flow elements</a>.</p>
<p>Each property may also have some metadata associated with it in the form of another property or attribute. The naming convention of metadata properties is the related property name with a suffix. e.g.,</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;device&quot;: {</div><div class="c-code__line">    &quot;javascript&quot;: &quot;&quot;,</div><div class="c-code__line">    &quot;javascriptdelayexecution&quot;: true</div><div class="c-code__line">}</div></div><p>List of suffixes:</p>
<div class="g-table g-table--overflow"><table class="c-table">
<tr class="c-table__row--heading">
<td class="c-table__cell">Suffix  </td><td class="c-table__cell">Description   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>nullreason</code>  </td><td class="c-table__cell">If the result for a property is null this field will be populated with a reason as to why there is no result.   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>delayexecution</code>  </td><td class="c-table__cell">If this value is true the related property is a JavaScript property and will not run immediately when evaluating the JavaScript Resource.   </td></tr>
<tr class="c-table__row">
<td class="c-table__cell"><code>evidenceproperties</code>  </td><td class="c-table__cell">A list of JavaScript properties which need to be evaluated first before this property can be populated.   </td></tr>
</table>
</div><p>This JSON data is sent to the client along with some JavaScript that is used to handle updating that JSON payload with new property values determined from client-side evidence as well as provide easy access to the property values in client-side JavaScript code.</p>
<h1 class="g-docs__section-heading">JavaScript properties</h1>
<p><a class="el" href="_pipeline_api__concepts__meta_data__element_properties.html">Element properties</a> include a 'Type' property that indicates the type of the data represented by the property's values.</p>
<p>JavaScript properties are simply properties that have their Type set to 'JavaScript'. The value of such a property should be a snippet of JavaScript code that, when run on the client device, will obtain some extra values from the device.</p>
<p><a class="el" href="_pipeline_api__concepts__meta_data__element_properties.html">Element properties</a> also include a 'DelayExecution' property which indicates if a 'JavaScript' property should not be executed on the client straight away and a 'EvidenceProperties' property which contains a list of JavaScript properties that, when executed, will obtain additional <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> that can help in determining the value of this property.</p>
<h1 class="g-docs__section-heading">How it works</h1>
<p>The JSON data management JavaScript will check for any properties of type 'JavaScript' and execute them on the client or if the 'DelayExecution' property is set to true then the 'JavaScript' will only be executed in response to some user action. There are then two possible mechanisms to get these extra values back to the server in order for them to be included in the evidence used by the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a>.</p>
<ol type="1">
<li>A background callback to the server yields updated JSON data that replaces the existing JSON payload.</li>
<li>The JavaScript property sets a cookie that is then sent to the server on the next request.</li>
</ol>
<h2>Background callback</h2>
<p>A request is made to the server in the background that includes the extra values as form parameters. The server sends this through the pipeline and the result is packaged as JSON and sent in the response to the client, which will update it's JSON payload data, making the new values available to all client-side code.</p>
<p>Adding this feature to the page may result in data being written to the client device using <code>cookies</code> or <code>sessionStorage</code> for efficiency. Any keys prefixed with <code>51D_</code> are 51Degrees cookies, and any keys prefixed with <code>fod_</code> are sessionStorage items used for efficient evidence handling and data transfer.</p>
<p>This example shows the process flow between client and server.</p>
<p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_client-side-evidence-callback.svg" width="728" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</p>
<h2>Cookies on next request</h2>
<p>When executed, the JavaScript property sets a cookie that is then sent to the server on the next request. The <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> will automatically use these cookies as <a class="el" href="_pipeline_api__concepts__data__evidence.html">evidence</a> so that the results it returns take account of the new information.</p>
<p>This example shows the process flow between client and server.</p>
<p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_client-side-evidence.svg" width="587" height="316"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</p>
<h2>Privacy Policy</h2>
<p>If you are using this feature, especially when using the server-side capability to return enriched data, it is your responsibility to consider any updates to your customer privacy policy.</p>
<p><b>This is not legal advice</b>, and you should consult your legal team for guidance.</p>
<p>If you are using the 51Degrees Cloud service, or would like to see an example of how to describe this in your service that incorporates client-side evidence, see our <a href="https://51degrees.com/terms/client-services-privacy-policy">Client Services Policy</a>.</p>
<p>For efficiency, we store limited data in cookies or session storage. Anything prefixed <code>51D_</code> or <code>fod_</code> is related to 51Degrees <b>client-side evidence</b> handling and is used solely for the purpose of enabling this technical feature.</p>
<h2>Storage Mechanism</h2>
<p>By default, when using the 51Degrees Cloud service, values returned from client-side evidence processing are stored using <code>sessionStorage</code>. This avoids setting any cookies unless explicitly required. However, this behaviour can be changed by adding the <code>fod-js-enable-cookies=true</code> query parameter to the Resource Key URL. When set, this instructs the client-side script to use <code>cookies</code> instead of <code>sessionStorage</code> for storing data.</p>
<p>For more details on this parameter and related options, see the <a href="https://cloud.51degrees.com/api-docs/index.html">Cloud API Documentation</a>.</p>
<h1 class="g-docs__section-heading">Web integration</h1>
<p>The <b>client-side evidence</b> feature requires multiple <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> components to operate together. There are <a class="el" href="_pipeline_api__features__web_integration.html">web integration</a> solutions for various web frameworks that handle most of the complexity for you.</p>
<p>These solutions are generally enabled by default but do require some additional configuration in order to function. The implementations vary significantly based on the language and framework, but the core steps will involve the following:</p>
<ul>
<li>Make a change to request the initial JavaScript with JSON payload. For example, by adding a JavaScript include.</li>
<li>If using the <b>background callback</b> mechanism:<ul>
<li>Create an endpoint that can pass requests to the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> and serve the required JSON response. *</li>
<li>Configure the JavaScriptBuilderElement with the URL for your endpoint. *</li>
<li>Add some JavaScript code to update the page content when new JSON data is received.</li>
</ul>
</li>
</ul>
<p>(*) These tasks are handled automatically by the ASP.NET Core, Java MVC and Java Servlet integrations</p>
<p>For more detailed, language-specific steps, see the <a class="el" href="_pipeline_api__examples__web_integration.html">web integration examples</a> or the engine-specific examples such as the <a class="el" href="_device_detection__examples__getting_started__web__index.html">device detection examples</a> or <a class="el" href="_reverse_geocoding__examples__web_integration__examples.html">reverse geocoding examples</a>. </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
