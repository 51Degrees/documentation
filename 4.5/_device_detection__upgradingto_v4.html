<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Upgrading to Version 4</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_device_detection__upgradingto_v4.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__index.html">Device Detection</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__upgradingto_v4.html">Upgrading to Version 4</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Upgrading to Version 4 </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Upgrading to 51Degrees Version 4</h1>
<p>This guide details how current Version 3 customers of 51Degrees can upgrade to Version 4.</p>
<p>Version 4 is faster, has a smaller data file, and has an upgraded algorithm that allows better detection of new, different, and rare User-Agents. Additionally, Version 4 has support for <a href="https://learnclienthints.com/">Google's changes to the User-Agent</a> and the new <a href="https://51degrees.com/blog/updates-to-user-agent-client-hints-version-4-4">User-Agent Client Hints</a> HTTP request header.</p>
<p>The steps to upgrade will vary depending on whether you are using our cloud or On-Premise service.</p>
<p><br />
</p>
<h2>V3 Cloud users <a href="#V3_Cloud">#</a><a class="anchor" id="V3_Cloud"></a></h2>
<p>Use our <a href="https://configure.51degrees.com/">Cloud Configurator</a> to generate a new Resource Key. You can follow our <a class="el" href="_services__configurator.html">Configurator explanation</a> for a step by step guide. This Resource Key should contain all the properties you wish to collect data for â€“ you can find a list of all the available properties on our <a href="https://51degrees.com/developers/property-dictionary">property dictionary</a>. Some advanced properties may require the purchase of a License Key. Sign up to one of our <a href="https://51degrees.com/pricing">pricing plans</a> to be granted a License Key.</p>
<p>If you are looking for User-Agent Client Hints support in the cloud, please follow the <a class="el" href="_device_detection__features__u_a_c_h__overview.html">User-Agent Client Hints documentation</a>.</p>
<p><br />
</p>
<h2>V3 On-premise users <a href="#V3_On_Prem">#</a><a class="anchor" id="V3_On_Prem"></a></h2>
<p>If you wish to continue to use 51Degrees On-Premise, you will need to purchase a License Key to access the Version 4 data files. Visit our <a href="https://51degrees.com/pricing">pricing</a> page and select the suitable plan for your needs. Alternatively, you may wish to use our <a class="el" href="_device_detection__upgradingto_v4.html#V3_Cloud">cloud service</a>, which can be called from the server via our APIs.</p>
<p>Once you have received a License Key after signing up for a pricing plan, you can use the key to download a data file for On-Premise implementations that contains all the properties. You can <a href="https://51degrees.com/developers/downloads">download the file manually</a> or set up <a class="el" href="_pipeline_api__features__automatic_datafile_updates.html">automatic data file updates</a>.</p>
<p>You can download the latest API packages for your programming language via our <a href="https://51degrees.com/developers/downloads">downloads page</a> or <a href="https://github.com/51Degrees">GitHub</a>.</p>
<p>Once you have obtained your new License Key and downloaded the latest API packages and data file, see the <a href="#migration-guides">language-specific migration guides</a> below for the next steps.</p>
<p>We also recommend enabling <a class="el" href="_pipeline_api__features__usage_sharing.html">usage sharing</a> in your environment. This allows our machine learning algorithm to grow and therefore detect new and unique User-Agents quicker with higher levels of accuracy.</p>
<p>If you are looking for User-Agent Client Hints support, please follow the <a class="el" href="_device_detection__features__u_a_c_h__overview.html">User-Agent Client Hints documentation</a>.</p>
<p>If you require any help upgrading, get in touch with <a href="https://51degrees.com/contact-us">Sales</a>.</p>
<p><br />
</p>
<h2>New customers <a href="#New_Customers">#</a><a class="anchor" id="New_Customers"></a></h2>
<p>If you wish to get started with 51Degrees, check out our <a href="https://51degrees.com/pricing" target="_blank">pricing</a> page for an overview of all our pricing tiers. You can then follow the <a class="el" href="_services__configurator.html">Configurator explanation</a> to get started in the cloud or use our <a class="el" href="_device_detection__examples__getting_started__web__on_premise.html">On-Premise documentation</a>.</p>
<p>Alternatively, get in touch with our <a href="https://51degrees.com/contact-us">Sales</a> team and mention your use case. Please provide as much information as possible such as intended deployment method, programming language, and environment configuration as this will help us discuss the best solution for you.</p>
<p><br />
</p>
<h1 class="g-docs__section-heading">Migration Guides <a href="#migration-guides">#</a><a class="anchor" id="migration-guides"></a></h1>
<p>This section describes the detailed steps for migrating from the previous 51Degrees Device detection API to either version 4 of that API or to the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> API where it is available. In either case, there are breaking changes so this guide should be followed carefully to ensure no problems arise.</p>
<h2>Overview</h2>
<p>The language that you are using is the most important factor in determining what work is required to migrate to the new API. For some languages and frameworks, such as C, Nginx, or Varnish, there is no <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> API so you will be migrating directly to version 4 of the Device Detection API. For other languages such as Java or .NET, you will be migrating from a pure device detection installation to the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> API with a device detection plugin.</p>
<h2>Language-Specific Migration Steps</h2>
<p>Regardless of which API you are migrating to, there are breaking changes and new features to be aware of. See the following section for detail on the changes needed for your language of choice.</p>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'c')">C</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'cpp')">C++</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'aspdotnet')">C# - ASP.NET Framework</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'aspdotnetcore')">C# - ASP.NET Core</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'java')">Java</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'php')">PHP</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'node')">Node.js</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'python')">Python</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'nginx')">Nginx</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'varnish')">Varnish</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a language to view a language specific migration guide. </div>   <div class="c-tabgroup__main" data-lang="c" style="display:none;"> </p>
<p>First, add the device detection libraries from the <a href="https://github.com/51degrees/device-detection-cxx">GitHub repo</a>. These can be included using the Visual Studio projects, the CMake projects, or just the files themselves.</p>
<p>The old (V3) device detection API used a single method to initialize a <code>fiftyoneDegreesProvider</code>. This took all available options as parameters, and was similar for both the 'Pattern' and 'Hash' algorithms.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">fiftyoneDegreesDataSetInitStatus status =</div><div class="c-code__line">    fiftyoneDegreesInitProviderWithPropertyString(</div><div class="c-code__line">    fileName, &amp;provider, properties, 4, 1000);</div></div><p>An equivalent service can be set up using the V4 device detection API. However, the Hash data files have been significantly improved for V4, and are now equivalent or superior to Pattern in every way. As such, Hash is now the only option. It takes the following parameters:</p>
<ol type="1">
<li>A resource manager. This is similar to the V3 provider, but provides a generic way of managing resources in a thread-safe manner.</li>
<li>A configuration structure. This defines the way the data set is used. For example, whether the data set is loaded into memory, or streamed from file.</li>
<li>A required properties structure. This is a structure which can contain a string or array indicating the properties which should be loaded.</li>
<li>Data file path. This is the path to the data file which should be loaded.</li>
<li>An exception structure. This provides a way for internal methods to report exceptions instead of allowing the process to crash.</li>
</ol>
<p>After setting any configuration options required in the config structure, the data set is initialized using the <code>fiftyoneDegreesHashInitManagerFromFile</code>, or <code>fiftyoneDegreesHashInitManagerFromMemory</code> method.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">fiftyoneDegreesStatusCode status =</div><div class="c-code__line">    fiftyoneDegreesHashInitManagerFromFile(</div><div class="c-code__line">        &amp;manager,</div><div class="c-code__line">        &amp;config,</div><div class="c-code__line">        &amp;properties,</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        exception);</div></div><p>To process a User-Agent with the old API, the <code>fiftyoneDegreesMatch</code> is called with a workset which has been fetched from the provider. Instead new set of results should be created, then the <code>fiftyoneDegreesResultsHashFromUserAgent</code> is used in a similar way to <code>fiftyoneDegreesMatch</code>.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">fiftyoneDegreesResultsHash *result =</div><div class="c-code__line">    fiftyoneDegreesResultsHashCreate(&amp;manager, 1, 0);</div><div class="c-code__line"></div><div class="c-code__line">fiftyoneDegreesResultsHashFromUserAgent(</div><div class="c-code__line">    results,</div><div class="c-code__line">    userAgent,</div><div class="c-code__line">    strlen(userAgent),</div><div class="c-code__line">    exception);</div></div><p>To get a value of a property in the old API, the <code>fiftyoneDegreesSetValues</code> and <code>fiftyoneDegreesGetString</code> methods were used. Using the new results structure, values of a property can be retrieved using the <code>fiftyoneDegreesResultsHashGetValueString</code> method.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">fiftyoneDegreesResultsPatternGetValuesString(</div><div class="c-code__line">    results,</div><div class="c-code__line">    propertyName,</div><div class="c-code__line">    valueBuffer,</div><div class="c-code__line">    <span class="c-code__keyword">sizeof</span>(valueBuffer),</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;,&quot;</span>,</div><div class="c-code__line">    exception);</div></div><p>Multiple HTTP header matching can follow a similar pattern to single User-Agent matching. Instead of a single string, a <code>fiftyoneDegreesEvidenceKeyValuePairArray</code> structure is used. Each header is added to the evidence before calling the <code>fiftyoneDegreesResultsHashFromEvidence</code> method.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">fiftyoneDegreesEvidenceKeyValuePairArray *evidence =</div><div class="c-code__line">    fiftyoneDegreesEvidenceCreate(1);</div><div class="c-code__line">fiftyoneDegreesEvidenceAddString(</div><div class="c-code__line">    evidence,</div><div class="c-code__line">    FIFTYONE_DEGREES_EVIDENCE_HTTP_HEADER_STRING,</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;User-Agent&quot;</span>,</div><div class="c-code__line">    userAgent);</div><div class="c-code__line"></div><div class="c-code__line">fiftyoneDegreesResultsHashFromEvidence(</div><div class="c-code__line">    results,</div><div class="c-code__line">    evidence,</div><div class="c-code__line">    exception);</div></div><p>Once finished, the results are released using the <code>fiftyoneDegreesResultsHashFree</code> method, and the data set with the <code>fiftyoneDegreesManagerFree</code> method.</p>
<p> </div>   <div class="c-tabgroup__main" data-lang="cpp" style="display:none;"> </p>
<p>First, add the device detection libraries from the <a href="https://github.com/51degrees/device-detection-cxx">GitHub repo</a>. These can be included using the Visual Studio projects, the CMake projects, or just the files themselves.</p>
<p>The old (V3) device detection API used a <code>Provider</code> class initialized with the path to the data file and the required properties, and was similar for Pattern and Hash.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">Provider *provider = Provider(fileName, properties);</div></div><p>An equivalent service can be set up using the V4 device detection API. Rather than a <code>Provider</code>, the equivalent class is an "Engine" which extends the <code>EngineBase</code> base class. An engine is constructed with the following:</p><ol type="1">
<li>Data file path. This is the path to the data file which should be loaded.</li>
<li>A configuration instance. This defines the way the data set is used. For example, whether the data set is loaded into memory, or streamed from file.</li>
<li>A required properties instance. This is a class which can contain a string or array indicating the properties which should be loaded.</li>
</ol>
<p>After setting any configuration options required in the config structure, the engine is constructed.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">RequiredPropertiesConfig *properties = <span class="c-code__keyword">new</span> RequiredPropertiesConfig(propertiesString);</div><div class="c-code__line">ConfigHash *config = <span class="c-code__keyword">new</span> ConfigHash();</div><div class="c-code__line"></div><div class="c-code__line">EngineHash *engine = <span class="c-code__keyword">new</span> EngineHash(dataFile, config, properties);</div></div><p>To process HTTP headers with the old API, the <code>provider-&gt;getMatch</code> is called with either a single User-Agent string, or a <code>map&lt;string, string&gt;</code> containing HTTP header names and values. Instead, an <code>EvidenceDeviceDetection</code> instance should be created, then the <code>engine-&gt;process</code> is used in a similar way to <code>provider-&gt;getMatch</code>. The <code>EvidenceBase</code> class actually extends <code>map&lt;string, string&gt;</code> so usage is almost identical. The difference is that the keys will be different to the old API. For example, instead of "User-Agent", the key would be "header.User-Agent". This is because more evidence is supported in the new API (e.g. cookies, query params).</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">EvidenceDeviceDetection *evidence = <span class="c-code__keyword">new</span> EvidenceDeviceDetection();</div><div class="c-code__line">evidence-&gt;operator[](<span class="c-code__stringliteral">&quot;header.User-Agent&quot;</span>) = userAgent;</div><div class="c-code__line"></div><div class="c-code__line">ResultsHash *results = engine-&gt;process(evidence);</div></div><p>Getting values from a <code>ResultsHash</code> (or any class extending <code>ResultsBase</code>) instance is similar to the old API, however the values returned are slightly different. Values follow the nullable pattern. For example, rather than returning a boolean, the <code>results-&gt;getValueAsBool</code> method returns a <code>Value&lt;bool&gt;</code> type that has <code>hasValue()</code> and <code>getValue()</code> methods (in addition to a <code>*</code> operator which maps to the <code>getValue()</code> method). Calling <code>getValue()</code> on a property value that does not have a value will result in an exception. For more detail see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">Value&lt;bool&gt; value = results-&gt;getValueAsBool(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordflow">if</span> (value.hasValue()) {</div><div class="c-code__line">    <span class="c-code__keywordtype">bool</span> isMobile = *value;</div><div class="c-code__line">}</div><div class="c-code__line"><span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">    <span class="c-code__comment">// No valid value.</span></div><div class="c-code__line">    <span class="c-code__keywordtype">string</span> reason = value.getNoValueMessage();</div><div class="c-code__line">}</div></div><p>Once finished, the results, evidence, engine, and configuration are freed using their destructors. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keyword">delete</span> results;</div><div class="c-code__line"><span class="c-code__keyword">delete</span> evidence;</div><div class="c-code__line"><span class="c-code__keyword">delete</span> engine;</div><div class="c-code__line"><span class="c-code__keyword">delete</span> config</div></div><p> </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;"> </p>
<p>Note: If you are working with a ASP.NET or ASP.NET Core web app then check those tabs for a more focused migration guide.</p>
<p>The <a class="el" href="_device_detection__examples__getting_started__console__index.html">getting started</a> examples may be a useful reference while migrating.</p>
<p>First, add the <code>FiftyOne.DeviceDetection</code> NuGet package. Don't forget to remove the old <code>51Degrees.mobi-core</code> package and any related packages as well.</p>
<p>The old (V3) device detection API generally had two initialization steps, one to create a <code>DataSet</code> and one to create a <code>Provider</code> from that <code>DataSet</code>. The precise details would depend on:</p><ul>
<li>Whether you are using the Pattern or Hash algorithm.</li>
<li>Whether you are loading all the data into memory for better performance or not.</li>
<li>Other DataSet creation options being used.</li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">DataSet dataSet = StreamFactory.Create(fileName, <span class="c-code__keyword">false</span>)</div><div class="c-code__line">Provider provider = <span class="c-code__keyword">new</span> Provider(dataSet);   </div></div><p>There are several ways to set up an equivalent service using the Pipeline API. For example, you could create the device detection engine and then create the Pipeline. However, the easiest method is to use a specific <code>DeviceDetectionPipelineBuilder</code>. This can be configured using a settings file or directly in code:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var pipeline = <span class="c-code__keyword">new</span> DeviceDetectionPipelineBuilder()</div><div class="c-code__line">  .UseOnPremise(dataFile, <span class="c-code__keyword">true</span>)</div><div class="c-code__line">  .SetPerformanceProfile(PerformanceProfiles.LowMemory)</div><div class="c-code__line">  .SetDataUpdateLicenseKey(<span class="c-code__stringliteral">&quot;yourkey&quot;</span>)</div><div class="c-code__line">  .Build()</div></div><p>The supplied settings will be dependent on your old implementation:</p>
<ul>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). Next, change the first line to <code>.UseCloud</code> and pass in the Resource Key you created.</li>
<li>If using <code>MemoryFactory</code> rather that <code>StreamFactory</code> then change the performance profile to <code>MaxPerformance</code>.</li>
<li>If using a custom caching configuration, you will need to create the device detection engine first using a <code>DeviceDetectionHashEngineBuilder</code>. The <code>SetCache</code> method can then be used to supply your custom configuration. Finally, the generic <code>PipelineBuilder</code> can be used to create a pipeline with the device detection engine added to it.</li>
<li>If you have auto updates disabled then remove the <code>SetDataUpdateLinceseKey</code> line and instead use <code>SetAutoUpdate(false)</code> and <code>SetUpdateOnStartup(false)</code>.</li>
</ul>
<p>Regardless of the details above, a configuration file can be used instead:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var config = <span class="c-code__keyword">new</span> ConfigurationBuilder()</div><div class="c-code__line">    <span class="c-code__comment">// Use this line for a json-based config file.</span></div><div class="c-code__line">    .AddJsonFile(<span class="c-code__stringliteral">&quot;appsettings.json&quot;</span>)</div><div class="c-code__line">    <span class="c-code__comment">// Or this one for an xml-based config file.</span></div><div class="c-code__line">    .AddXmlFile(<span class="c-code__stringliteral">&quot;App.config&quot;</span>)</div><div class="c-code__line">    .Build();</div><div class="c-code__line">    </div><div class="c-code__line"><span class="c-code__comment">// Bind the configuration to a pipeline options instance</span></div><div class="c-code__line">PipelineOptions options = <span class="c-code__keyword">new</span> PipelineOptions();</div><div class="c-code__line">config.Bind(<span class="c-code__stringliteral">&quot;PipelineOptions&quot;</span>, options);  </div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Create the pipeline using the options object</span></div><div class="c-code__line">var pipeline = <span class="c-code__keyword">new</span> FiftyOnePipelineBuilder()</div><div class="c-code__line">    .BuildFromConfiguration(options)</div></div><p>The JSON configuration file for the same setup as above (on premise, low memory, auto updates enabled) would look like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;51Degrees-EnterpriseV4.1.hash&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: true,</div><div class="c-code__line">          &quot;DataUpdateLicenseKey&quot;: &quot;yourkey&quot;,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><p>If you are using the 51Degrees cloud then you'll need to add two elements using the builders <code>CloudRequestEngineBuilder</code> and <code>DeviceDetectionCloudEngineBuilder</code>. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;CloudRequestEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;ResourceKey&quot;: &quot;yourresourcekey&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      },</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionCloudEngineBuilder&quot;</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><p>Once the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> has been created, you'll need to make a few changes to the way data is passed to it. With the old API, you would do something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">match = provider.Match(userAgent);</div></div><p>The Pipeline API is far more flexible so splits this line into 3 parts:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">// 1. Create a &#39;FlowData&#39; instance from the Pipeline. This is used to pass data in and access results.</span></div><div class="c-code__line">var data = pipeline.CreateFlowData()</div><div class="c-code__line"><span class="c-code__comment">// 2. Add &#39;evidence&#39; to the FlowData and process it. In this case, we are adding a User-Agent HTTP header.</span></div><div class="c-code__line"><span class="c-code__comment">// Note that if you have an HTTPContext then there is a helper to add all the associated values to evidence for you.</span></div><div class="c-code__line">  .AddEvidence(<span class="c-code__stringliteral">&quot;header.User-Agent&quot;</span>, mobileUserAgent)</div><div class="c-code__line">  .Process();</div><div class="c-code__line"><span class="c-code__comment">// 3. The Pipeline can return all sorts of different data so we need to tell it the type of data that we want. In this case, details about the device associated with the User-Agent.</span></div><div class="c-code__line">var device = data.Get&lt;IDeviceData&gt;();</div></div><p>Finally, the way that data is accessed has also changed in several ways.</p><ol type="1">
<li>Values can now be accessed by strongly typed properties rather than having to remember 'magic strings' (although magic string accessors still work as well).</li>
<li>Many properties follow the nullable pattern. For example, rather than returning a boolean, the 'IsMobile' property returns a wrapper type that has 'HasValue' and 'Value' accessors. Calling '.Value' on a property that does not have a value will result in an exception. For more detail see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</li>
</ol>
<p>As an example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var isMobile = match[<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>].ToBool();</div></div><p>becomes:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordflow">if</span>(device.IsMobile.HasValue)</div><div class="c-code__line">{</div><div class="c-code__line">    var isMobile = device.IsMobile.Value;</div><div class="c-code__line">}</div></div><p>If you don't mind specifying the return type and dealing with magic strings, you can cut out a step and access properties directly from the flow data if desired. E.g:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordflow">if</span>(data.GetAs&lt;AspectPropertyValue&gt;(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>).HasValue)</div><div class="c-code__line">{</div><div class="c-code__line">    var isMobile = data.GetAs&lt;AspectPropertyValue&gt;(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>).Value;</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="aspdotnet" style="display:none;"> </p>
<p>This section describes how to migrate from the ASP.NET integration in version 3 of the device detection API to the ASP.NET integration in Pipeline API. Note - The redirect, image optimization and performance monitoring services are no longer supported in the Pipeline API.</p>
<p>The <a class="el" href="_device_detection__examples__getting_started__web__index.html">getting started</a> examples may be a useful reference while migrating.</p>
<p>First, add the <code>FiftyOne.DeviceDetection</code> and <code>FiftyOne.Pipeline.Web</code> NuGet packages. Don't forget to remove the old <code>51Degrees.mobi-core</code> package and any related packages as well.</p>
<p>The main difference is in the configuration file supplied to the Pipeline. This must be in the App_Data folder and can be named:</p>
<ul>
<li>pipeline.xml</li>
<li>pipeline.config (xml format expected)</li>
<li>pipeline.json</li>
<li>51degrees.xml</li>
<li>51degrees.config (xml format expected)</li>
<li>51degrees.json</li>
</ul>
<p>This file should follow the usual structure of a pipeline configuration file. For example, a typical device detection configuration would be:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;C:\\Absolute\\Path\\To\\Data\\File\\51Degrees-EnterpriseV4.1.hash&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: true,</div><div class="c-code__line">          &quot;DataUpdateLicenseKey&quot;: &quot;yourkey&quot;,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><ul>
<li><b>IMPORTANT:</b> <code>C:\\Absolute\\Path\\To\\Data\\File\\51Degrees-EnterpriseV4.1.hash</code> is an absolute path to the data file. <b>Please amend this entry accordingly to your configuration.</b></li>
<li>Use the performance profile setting to control the trade-off between performance and memory. <code>LowMemory</code> is recommended if you're not sure. <code>MaxPerformance</code> uses the most memory but gives the best performance.</li>
<li>If you have auto updates disabled then remove the <code>DataUpdateLicenseKey</code> line and instead use <code>"AutoUpdate": false</code> and <code>"DataUpdateOnStartup": false</code></li>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). See the next snippet below for an example of how to supply this Resource Key to the Pipeline.</li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;CloudRequestEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;ResourceKey&quot;: &quot;yourresourcekey&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      },</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionCloudEngineBuilder&quot;</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><ul>
<li>Modification to <code>Application_Start</code> method in the application class from <code>"global.asax.cs"</code> file to include loading of assemblies required by the pipeline is needed. Again, this is different for cloud and On-Premise scenarios. See snippets for both below.</li>
</ul>
<p>On-premise: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keyword">using</span> FiftyOne.DeviceDetection.Hash.Engine.OnPremise.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> FiftyOne.Pipeline.Engines.FiftyOne.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> FiftyOne.Pipeline.JavaScriptBuilder.FlowElement;</div><div class="c-code__line"><span class="c-code__keyword">using</span> FiftyOne.Pipeline.JsonBuilder.FlowElement;</div><div class="c-code__line">.</div><div class="c-code__line">.</div><div class="c-code__line">.</div><div class="c-code__line"><span class="c-code__comment">// Make sure the assemblies that are needed by the pipeline</span></div><div class="c-code__line"><span class="c-code__comment">// are loaded into the app domain.</span></div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(DeviceDetectionHashEngineBuilder).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(JavaScriptBuilderElement).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(JsonBuilderElement).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(SequenceElementBuilder).Assembly.GetName());</div></div><p>Cloud: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">using FiftyOne.DeviceDetection.Cloud.FlowElements;</div><div class="c-code__line">using FiftyOne.Pipeline.CloudRequestEngine.FlowElements;</div><div class="c-code__line">using FiftyOne.Pipeline.Engines.FiftyOne.FlowElements;</div><div class="c-code__line">using FiftyOne.Pipeline.JavaScriptBuilder.FlowElement;</div><div class="c-code__line">using FiftyOne.Pipeline.JsonBuilder.FlowElement;</div><div class="c-code__line">.</div><div class="c-code__line">.</div><div class="c-code__line">.</div><div class="c-code__line">// Make sure the assemblies that are needed by the pipeline</div><div class="c-code__line">// are loaded into the app domain.</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(CloudRequestEngine).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(DeviceDetectionCloudEngine).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(JavaScriptBuilderElement).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(JsonBuilderElement).Assembly.GetName());</div><div class="c-code__line">AppDomain.CurrentDomain.Load(typeof(SequenceElementBuilder).Assembly.GetName());</div></div><p>The old v3 web integration used the <code>Request.Browser</code> functionality that was built in to ASP.NET in order to access result values. The Pipeline integration uses the same approach so you can still do things like:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordflow">if</span> (Request.Browser[<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>] == <span class="c-code__stringliteral">&quot;True&quot;</span>)</div></div><p>See the <a href="https://51degrees.com/developers/property-dictionary">property dictionary</a> for a complete list of the available properties.</p>
<p>If you need to access values specific to the 51Degrees implementation then you can do so by casting to <code>PipelineCapabilities</code> and accessing the <code>FlowData</code> instance:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var flowData = ((PipelineCapabilities)Request.Browser).FlowData;</div><div class="c-code__line">var deviceData = flowData.Get&lt;IDeviceData&gt;();</div></div><p>You may also want to access metadata relating to profiles, properties, etc. This data can be obtained from the device detection engine. You can access this by getting the <code>IPipeline</code> instance from the static <code>WebPipeline</code> class:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var deviceDetectionPipeline = WebPipeline.GetInstance();</div><div class="c-code__line">var engine = deviceDetectionPipeline.GetElement&lt;DeviceDetectionHashEngine&gt;(); </div></div><p>Finally, if you use client-side overrides (which enables detection of Apple models), you'll need to make sure you add a script tag for <code>51degrees.core.js</code>. The 51Degrees infrastructure will intercept this request and serve the JavaScript that is used to gather the necessary client side data and pass it back to the server.</p>
<p>You can see examples of this feature in action in the <a class="el" href="_device_detection__examples__getting_started__web__index.html">getting started</a> web examples.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;script async src=&#39;51Degrees.core.js&#39; type=&#39;text/javascript&#39;&gt;&lt;/script&gt;</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="aspdotnetcore" style="display:none;"> </p>
<p>This section describes how to migrate from the ASP.NET integration in version 3 of the device detection API to the ASP.NET Core integration in Pipeline API. Note - The redirect, image optimization and performance monitoring services are no longer supported in the Pipeline API.</p>
<p>The <a class="el" href="_device_detection__examples__getting_started__web__index.html">getting started</a> examples may be a useful reference while migrating.</p>
<p>First, add the <code>FiftyOne.DeviceDetection</code> and <code>FiftyOne.Pipeline.Web</code> NuGet packages. Don't forget to remove the old <code>51Degrees.mobi-core</code> package and any related packages as well.</p>
<p>Add the following lines to you 'ConfigureService' method:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">services.AddSingleton&lt;DeviceDetectionHashEngineBuilder&gt;();</div><div class="c-code__line">services.AddFiftyOne&lt;PipelineBuilder&gt;(Configuration);</div></div><p>Add the following line to the 'Configure' method:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">app.UseFiftyOne();</div></div><p>Add a PipelineOptions section to your appsettings.json file and configure appropriately. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;Logging&quot;: {</div><div class="c-code__line">    &quot;LogLevel&quot;: {</div><div class="c-code__line">      &quot;Default&quot;: &quot;Warning&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  },</div><div class="c-code__line">  &quot;AllowedHosts&quot;: &quot;*&quot;,</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;51Degrees-EnterpriseV4.1.hash&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: true,</div><div class="c-code__line">          &quot;DataUpdateLicenseKey&quot;: &quot;yourkey&quot;,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><ul>
<li>Use the performance profile setting to control the trade-off between performance and memory. <code>LowMemory</code> is recommended if you're not sure. <code>MaxPerformance</code> uses the most memory but gives the best performance.</li>
<li>If you have auto updates disabled then remove the <code>DataUpdateLicenseKey</code> line and instead use <code>"AutoUpdate": false</code> and <code>"DataUpdateOnStartup": false</code></li>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). See the next snippet below for an example of how to supply this Resource Key to the Pipeline.</li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;PipelineOptions&quot;: {</div><div class="c-code__line">  &quot;Elements&quot;: [</div><div class="c-code__line">    {</div><div class="c-code__line">      &quot;BuilderName&quot;: &quot;CloudRequestEngineBuilder&quot;,</div><div class="c-code__line">      &quot;BuildParameters&quot;: {</div><div class="c-code__line">        &quot;ResourceKey&quot;: &quot;yourresourcekey&quot;</div><div class="c-code__line">      }</div><div class="c-code__line">    },</div><div class="c-code__line">    {</div><div class="c-code__line">      &quot;BuilderName&quot;: &quot;DeviceDetectionCloudEngineBuilder&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  ]</div><div class="c-code__line">}</div></div><p>You can now use dependency injection to access data from the Pipeline in your controllers. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>HomeController : Controller</div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">private</span> IFlowDataProvider _dataProvider;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keyword">public</span> HomeController(IFlowDataProvider dataProvider)</div><div class="c-code__line">    {</div><div class="c-code__line">        _dataProvider = dataProvider;</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keyword">public</span> IActionResult Index()</div><div class="c-code__line">    {</div><div class="c-code__line">        var data = _dataProvider.GetFlowData().Get&lt;IDeviceData&gt;();</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span> View(data);</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><p>The device properties can then be accessed in the corresponding view. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">@model FiftyOne.DeviceDetection.IDeviceData</div><div class="c-code__line">@{</div><div class="c-code__line">    ViewData[&quot;Title&quot;] = &quot;Device detection example&quot;;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;h2&gt;Example&lt;/h2&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    Hardware Vendor: @(hardwareVendor.HasValue ? hardwareVendor.Value : $&quot;Unknown ({hardwareVendor.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Hardware Name: @(hardwareName.HasValue ? string.Join(&quot;, &quot;, hardwareName.Value) : $&quot;Unknown ({hardwareName.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Device Type: @(deviceType.HasValue ? deviceType.Value : $&quot;Unknown ({deviceType.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Platform Vendor: @(platformVendor.HasValue ? platformVendor.Value : $&quot;Unknown ({platformVendor.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Platform Name: @(platformName.HasValue ? platformName.Value : $&quot;Unknown ({platformName.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Platform Version: @(platformVersion.HasValue ? platformVersion.Value : $&quot;Unknown ({platformVersion.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Browser Vendor: @(browserVendor.HasValue ? browserVendor.Value : $&quot;Unknown ({browserVendor.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Browser Name: @(browserName.HasValue ? browserName.Value : $&quot;Unknown ({browserName.NoValueMessage})&quot;)&lt;br /&gt;</div><div class="c-code__line">    Browser Version: @(browserVersion.HasValue ? browserVersion.Value : $&quot;Unknown ({browserVersion.NoValueMessage})&quot;)</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line"></div><div class="c-code__line">@await Component.InvokeAsync(&quot;FiftyOneJS&quot;)</div></div><p>The <code>FiftyOneJS</code> component handles the inclusion of <a class="el" href="_pipeline_api__features__client_side_evidence.html">client-side evidence</a>. The main use-case for this in device detection is in detecting iPhone/iPad models correctly.  </div>   <div class="c-tabgroup__main" data-lang="java" style="display:none;"> </p>
<p>First, add the <code>com.51degrees.device-detection</code> Maven package.</p>
<p>The old (V3) device detection API generally had two initialization steps, one to create a <code>DataSet</code> and one to create a <code>Provider</code> from that <code>DataSet</code>. The precise details would depend on:</p><ul>
<li>Whether you are using the Pattern or Hash algorithm.</li>
<li>Whether you are loading all the data into memory for better performance or not.</li>
<li>Other DataSet creation options being used.</li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">DataSet dataSet = StreamFactory.create(filename, <span class="c-code__keyword">false</span>);</div><div class="c-code__line">Provider provider = <span class="c-code__keyword">new</span> Provider(dataSet);   </div></div><p>There are several ways to set up an equivalent service using the Pipeline API. For example, you could create the device detection engine and then create the Pipeline. However, the easiest method is to use a specific <code>DeviceDetectionPipelineBuilder</code>. This can be configured using a settings file or directly in code:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">Pipeline pipeline = <span class="c-code__keyword">new</span> DeviceDetectionPipelineBuilder()</div><div class="c-code__line">  .useOnPremise(dataFile, <span class="c-code__keyword">false</span>)</div><div class="c-code__line">  .setPerformanceProfile(Constants.PerformanceProfiles.LowMemory)</div><div class="c-code__line">  .setDataUpdateLicenseKey(<span class="c-code__stringliteral">&quot;yourkey&quot;</span>)</div><div class="c-code__line">  .build();</div></div><p>Settings will be dependent on your old implementation:</p>
<ul>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). Next, change the first line to <code>.useCloud</code> and pass in the Resource Key you created.</li>
<li>If using <code>MemoryFactory</code> rather than <code>StreamFactory</code> then change the performance profile to <code>MaxPerformance</code>.</li>
<li>If using a custom caching configuration, you will need to create the device detection engine first using a <code>DeviceDetectionCloudEngineBuilder</code> (cache is not available on hash engine). The <code>setCache</code> method can then be used to supply your custom configuration. Finally, the generic <code>PipelineBuilder</code> can be used to create a pipeline with the device detection engine added to it.</li>
<li>If you have auto updates disabled then remove the <code>setDataUpdateLincenseKey</code> line and instead use <code>setAutoUpdate(false)</code> and <code>setUpdateOnStartup(false)</code></li>
</ul>
<p>Regardless of the details above, a configuration file can be used instead:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">// Create the configuration object</span></div><div class="c-code__line">File file = <span class="c-code__keyword">new</span> File(<span class="c-code__stringliteral">&quot;yourconfiguration.xml&quot;</span>).getFile());</div><div class="c-code__line">PipelineOptions pipelineOptions = PipelineOptionsFactory.getOptionsFromFile(file);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__comment">// Create a simple pipeline to access the engine with.</span></div><div class="c-code__line">Pipeline pipeline = <span class="c-code__keyword">new</span> FiftyOnePipelineBuilder()</div><div class="c-code__line">    .buildFromConfiguration(options);</div></div><p>The XML configuration file for the same setup as above (On-Premise, low memory, auto updates enabled) would look like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;?<span class="c-code__keyword">xml</span> <span class="c-code__keyword">version</span>=<span class="c-code__stringliteral">&quot;1.0&quot;</span> <span class="c-code__keyword">encoding</span>=<span class="c-code__stringliteral">&quot;utf-8&quot;</span> ?&gt;</div><div class="c-code__line">&lt;<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div><div class="c-code__line">    &lt;<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">DataUpdateLicenseKey</span>&gt;<span class="c-code__keyword">yourkey</span>&lt;/<span class="c-code__keywordtype">DataUpdateLicenseKey</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">CreateTempDataCopy</span>&gt;<span class="c-code__keyword">true</span>&lt;/<span class="c-code__keywordtype">CreateTempDataCopy</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">DataFile</span>&gt;51<span class="c-code__keyword">Degrees-EnterpriseV4.1.hash</span>&lt;/<span class="c-code__keywordtype">DataFile</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">PerformanceProfile</span>&gt;<span class="c-code__keyword">LowMemory</span>&lt;/<span class="c-code__keywordtype">PerformanceProfile</span>&gt;</div><div class="c-code__line">            &lt;/<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuilderName</span>&gt;<span class="c-code__keyword">DeviceDetectionHashEngineBuilder</span>&lt;/<span class="c-code__keywordtype">BuilderName</span>&gt;</div><div class="c-code__line">        &lt;/<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">    &lt;/<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">&lt;/<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div></div><p>If you are using the 51Degrees cloud then you'll need to add two elements using the builders <code>CloudRequestEngineBuilder</code> and <code>DeviceDetectionCloudEngineBuilder</code>. For example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;?<span class="c-code__keyword">xml</span> <span class="c-code__keyword">version</span>=<span class="c-code__stringliteral">&quot;1.0&quot;</span> <span class="c-code__keyword">encoding</span>=<span class="c-code__stringliteral">&quot;utf-8&quot;</span> ?&gt;</div><div class="c-code__line">&lt;<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div><div class="c-code__line">    &lt;<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">ResourceKey</span>&gt;<span class="c-code__keyword">yourresourcekey</span>&lt;/<span class="c-code__keywordtype">ResourceKey</span>&gt;</div><div class="c-code__line">            &lt;/<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuilderName</span>&gt;<span class="c-code__keyword">CloudRequestEngine</span>&lt;/<span class="c-code__keywordtype">BuilderName</span>&gt;</div><div class="c-code__line">        &lt;/<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuilderName</span>&gt;<span class="c-code__keyword">DeviceDetectionCloudEngine</span>&lt;/<span class="c-code__keywordtype">BuilderName</span>&gt;</div><div class="c-code__line">        &lt;/<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">    &lt;/<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">&lt;/<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div></div><p>Once the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> has been created, you'll need to make a few changes to the way data is passed to it. With the old API, you would do something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">match = provider.Match(userAgent);</div></div><p>The Pipeline API is far more flexible so splits this line into 3 parts:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">// Create a &#39;FlowData&#39; instance from the Pipeline. This is used to pass data in and access results.</span></div><div class="c-code__line"><span class="c-code__comment">// always use &quot;try with resources&quot; to dispose the flowData when you are done.</span></div><div class="c-code__line"><span class="c-code__keywordflow">try</span>(FlowData data = pipeline.createFlowData()){</div><div class="c-code__line">     <span class="c-code__comment">// Add &#39;evidence&#39; to the FlowData and process it. In this case, we are adding a User-Agent HTTP header.</span></div><div class="c-code__line">    data.addEvidence(<span class="c-code__stringliteral">&quot;header.user-agent&quot;</span>, userAgent)</div><div class="c-code__line">    <span class="c-code__comment">// remember to add client hints where applicable</span></div><div class="c-code__line">    .addEvidence(<span class="c-code__stringliteral">&quot;header.sec-ch-ua-mobile&quot;</span>, secChUaMobile)</div><div class="c-code__line">    ...</div><div class="c-code__line">    .process();</div><div class="c-code__line">    <span class="c-code__comment">// The Pipeline can return all sorts of different data so we need to tell it the type of data that we want. In this case, details about the device associated with the User-Agent.</span></div><div class="c-code__line">    DeviceData device = data.get(DeviceData.class);</div><div class="c-code__line">    ...</div><div class="c-code__line">}</div></div><p>Finally, the way that data is accessed has also changed in several ways.</p><ol type="1">
<li>Values can now be accessed by strongly typed properties rather than having to remember 'magic strings' (although magic string accessors still work as well).</li>
<li>Many properties follow the nullable pattern. For example, rather than returning a boolean, the 'IsMobile' property returns a wrapper type that has 'hasValue' and 'value' accessors. Calling '.gertValue' on a property that does not have a value will result in an exception. For more detail see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</li>
</ol>
<p>As an example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordtype">boolean</span> isMobile = match.getValues(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>).ToBoolean();</div></div><p>becomes:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordflow">if</span>(device.getIsMobile().hasValue) {</div><div class="c-code__line">    <span class="c-code__keywordtype">boolean</span> isMobile = device.getIsMobile().getValue();</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="node" style="display:none;"> </p>
<p>First, add the fiftyone.devicedetection package from NPM.</p>
<p>With the V3 API, a provider could be created with something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">// Set the config.</div><div class="c-code__line">var config = {&quot;dataFile&quot; : require(&quot;fiftyonedegreeslitepattern&quot;),</div><div class="c-code__line">              &quot;properties&quot; : &quot;IsMobile&quot;,</div><div class="c-code__line">              &quot;cacheSize&quot; : 10000,</div><div class="c-code__line">              &quot;poolSize&quot; : 4,</div><div class="c-code__line">              &quot;stronglyTyped&quot;: false</div><div class="c-code__line">             };</div><div class="c-code__line">var provider = new fiftyonedegrees.provider(config);</div></div><p>Creating a Pipeline with a device detection engine is similar although the options are different. You can use either the generic builder or the specific one for On-Premise or cloud separately.</p>
<p>Using the generic builder:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">// Create a new device detection pipeline and set the config.</div><div class="c-code__line">let pipeline = new deviceDetectionPipelineBuilder({    </div><div class="c-code__line">    performanceProfile: &quot;MaxPerformance&quot;,</div><div class="c-code__line">    dataFile: &quot;[your path]/51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">    autoUpdate: false</div><div class="c-code__line">}).build();</div></div><p>Using the specific On-Premise builder:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">const pipeline = new DeviceDetectionOnPremisePipelineBuilder({</div><div class="c-code__line">    performanceProfile: &quot;MaxPerformance&quot;,</div><div class="c-code__line">    dataFile: &quot;[your path]/51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">    autoUpdate: false</div><div class="c-code__line">  }).build();</div></div><p>Using the specific cloud builder:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">const pipeline = new DeviceDetectionCloudPipelineBuilder({</div><div class="c-code__line">    resourceKey: &quot;[your Resource Key]&quot;</div><div class="c-code__line">  }).build();</div></div><p>Settings will be dependent on your old implementation:</p>
<ul>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). Next, remove the dataFile line from the configuration and add the Resource Key you created.</li>
<li>If you want to trade some performance for system memory then change the performance profile to <code>MaxPerformance</code>, <code>Balanced</code> or <code>LowMemory</code></li>
<li>If you want the data file to be updated automatically then remove <code>autoUpdate: false</code> and add your License Key to the configuration. (Not available for free users)</li>
</ul>
<p>You can also build a <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> from a JSON configuration file:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">let pipeline = new pipelineBuilder().buildFromConfigurationFile(&quot;settings.json&quot;);</div></div><p> Where settings.json contains the following:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">    &quot;PipelineOptions&quot;: {</div><div class="c-code__line">        &quot;Elements&quot;: [</div><div class="c-code__line">        {</div><div class="c-code__line">            &quot;elementName&quot;: &quot;fiftyone.pipeline.devicedetection/deviceDetectionOnPremise&quot;,  </div><div class="c-code__line">            &quot;elementParameters&quot;: {</div><div class="c-code__line">                &quot;performanceProfile&quot;: &quot;MaxPerformance&quot;,</div><div class="c-code__line">                &quot;dataFile&quot;: &quot;51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">                &quot;autoUpdate&quot;: false</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">        ]</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><p>Once the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> has been created, you'll need to make a few changes to the way data is passed to it and accessed. With the old API, you would do something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var device = provider.getMatch(userAgent);</div></div><p>In the new API, this is slightly more complicated as it needs to deal with the potential for different types of data in and out.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">// 1. Create a &#39;FlowData&#39; instance from the Pipeline. This is used to pass data in and access results.</div><div class="c-code__line">let flowData = pipeline.createFlowData();</div><div class="c-code__line">// 2. Add &#39;evidence&#39; to the FlowData and process it. In this case, we are adding a User-Agent HTTP header.</div><div class="c-code__line">flowData.evidence.add(&quot;header.user-agent&quot;, userAgent);</div><div class="c-code__line">flowData.process().then(function () {</div><div class="c-code__line">    // 3. The Pipeline can return all sorts of different data so we need to tell it the type of data that we want. In this case, details about the device associated with the User-Agent.</div><div class="c-code__line">    var device = flowData.device;</div><div class="c-code__line">});</div></div><p>Accessing the property values is similar in the new API and the old API. The main difference is the addition of the 'hasValue' property that is used to indicate when no match has been found. For more detail on this see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</p>
<p>As an example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var isMobile = device.ismobile;</div></div><p>Becomes:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">if(device.ismobile.hasValue) {</div><div class="c-code__line">    var isMobile = device.ismobile.value;</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="python" style="display:none;"> </p>
<p>First, add the fiftyone_devicedetection package from PyPi.</p>
<p>With the V3 API, a provider could be created with something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">provider = fiftyone_degrees_mobile_detector_v3_trie_wrapper.Provider(</div><div class="c-code__line">    dataFile,</div><div class="c-code__line">    properties)</div></div><p>Creating a Pipeline with a device detection engine is similar although the options are different:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">pipeline = DeviceDetectionPipelineBuilder(</div><div class="c-code__line">  data_file_path = data_file,</div><div class="c-code__line">  performance_profile = &quot;LowMemory&quot;,</div><div class="c-code__line">  auto_update = False).build()</div></div><p>Settings will be dependent on your old implementation:</p>
<ul>
<li>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). Next, remove the dataFile line from the configuration and add the Resource Key you created.</li>
<li>If you want to trade some performance for system memory then change the performance profile to <code>MaxPerformance</code>, <code>Balanced</code> or <code>LowMemory</code></li>
<li>If you want the data file to be updated automatically then remove <code>auto_update: false</code> and add your License Key to the configuration. (Not available for free users)</li>
</ul>
<p>Once the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> has been created, you'll need to make a few changes to the way data is passed to it and accessed. With the old API, you would do something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">match = provider.getMatch(userAgent)</div></div><p>In the new API, this is slightly more complicated as it needs to deal with the potential for different types of data in and out.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">// 1. Create a &#39;FlowData&#39; instance from the Pipeline. This is used to pass data in and access results.</div><div class="c-code__line">flowData = pipeline.create_flowdata()</div><div class="c-code__line">// 2. Add &#39;evidence&#39; to the FlowData and process it. In this case, we are adding a User-Agent HTTP header.</div><div class="c-code__line">flowData.evidence.add(&quot;header.user-agent&quot;, userAgent)</div><div class="c-code__line">// 3. The Pipeline can return all sorts of different data so we need to tell it the type of data that we want. In this case, details about the device associated with the User-Agent.</div><div class="c-code__line">device = flowData.device</div></div><p>Accessing the property values is similar in the new API and the old API. The main difference is the addition of the 'hasValue' property that is used to indicate when no match has been found. For more detail on this see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</p>
<p>As an example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">match.getValues(&#39;IsMobile&#39;)</div></div><p>Becomes:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">if (device.ismobile.has_value():</div><div class="c-code__line">  isMobile = device.ismobile.value()</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="php" style="display:none;"> </p>
<p>If you currently use an On-Premise data file with PHP then you will need to get the On-Premise version of the PHP API from <a href="https://github.com/51Degrees/device-detection-php-onpremise">GitHub</a>.</p>
<p>If you use the cloud version then you can install the fiftyone.devicedetection package from composer.</p>
<p>With the V3 API, a provider could be created with something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">$provider = FiftyOneDegreesPatternV3::provider_get();</div></div><p>If using the 51Degrees cloud service, you'll first need to use <a href="https://configure.51degrees.com">the Configurator</a> to create a Resource Key (this will only take a few minutes and does not require any payment). Next, create a device detection pipeline using the Resource Key you created:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">$deviceDetectionPipeline = <span class="c-code__keyword">new</span> deviceDetectionPipelineBuilder(array(</div><div class="c-code__line">    <span class="c-code__stringliteral">&quot;resourceKey&quot;</span> =&gt; <span class="c-code__stringliteral">&quot;[Yourkey]&quot;</span></div><div class="c-code__line">));</div><div class="c-code__line">$deviceDetectionPipeline = $deviceDetectionPipeline-&gt;build();</div></div><p>Once the <a class="el" href="_pipeline_api__concepts__pipeline.html">Pipeline</a> has been created, you'll need to make a few changes to the way data is passed to it and accessed. With the old API, you would do something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">$match = $provider-&gt;getMatch($mobileUserAgent);</div></div><p>In the new API, this is slightly more complicated as it needs to deal with the potential for different types of data in and out.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">// 1. Create a &#39;FlowData&#39; instance from the Pipeline. This is used to pass data in and access results.</div><div class="c-code__line">$flowData = $deviceDetectionPipeline-&gt;createFlowData();</div><div class="c-code__line">// 2. Add &#39;evidence&#39; to the FlowData. In this case, we are adding a User-Agent HTTP header.</div><div class="c-code__line">$flowData-&gt;evidence-&gt;set(&quot;header.user-agent&quot;, userAgent);</div><div class="c-code__line">// 3. Process the evidence.</div><div class="c-code__line">$pipelineResult = $flowData-&gt;process();</div><div class="c-code__line">// 4. The Pipeline can return all sorts of different data so we need to tell it the type of data that we want. In this case, details about the device associated with the User-Agent.</div><div class="c-code__line">$device = $pipelineResult-&gt;get(&quot;device&quot;)</div></div><p>Accessing the property values is similar in the new API and the old API. The main difference is the addition of the 'hasValue' property that is used to indicate when no match has been found. For more detail on this see the <a class="el" href="_device_detection__features__false_positive_control.html">false positive control</a> feature page.</p>
<p>As an example:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">$isMobile = $match-&gt;getValue(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>);</div></div><p>Becomes:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keywordflow">if</span>($device-&gt;get(<span class="c-code__stringliteral">&quot;ismobile&quot;</span>)-&gt;hasValue) {</div><div class="c-code__line">    $isMobile = $device-&gt;get(<span class="c-code__stringliteral">&quot;ismobile&quot;</span>).value;</div><div class="c-code__line">}</div></div><p> </div>   <div class="c-tabgroup__main" data-lang="nginx" style="display:none;"> </p>
<p>Nginx module comes only with an On-Premise version, you will need to get the On-Premise version of the Nginx API from <a href="https://github.com/51Degrees/device-detection-nginx">GitHub</a>.</p>
<p>The implementation of 51Degrees Device Detection V4 module is based on the V3 version and the migration process from V3 to V4 is straightforward. Existing V3 customers can build and use V4 in a similar way as V3. Please make sure to obtain a V4 Hash data file using 51Degrees <a class="el" href="_services__distributor.html">Distributor</a> (License Key is required, check <a href="https://51degrees.com/pricing">pricing</a> page) and be aware of the changes described below.</p>
<p>Removed in V4:</p><ul>
<li>V4 version supports only one method of detection which is Hash.<ul>
<li>Building V4 module is done as below without specifying the detection method: <div class="c-code__block c-code__block--outline"><div class="c-code__line">make install</div></div></li>
</ul>
</li>
<li>The following build options are not available:<ul>
<li><code>FIFTYONEDEGREES_CACHE_KEY_LENGTH</code></li>
<li><code>FIFTYONEDEGREES_VALUE_SEPARATOR</code></li>
</ul>
</li>
<li>The following directives are removed or changed:<ul>
<li><code>51D_cache</code> is removed.</li>
<li><code>51D_filePath</code> changed to <code>51D_file_path</code>.</li>
<li><code>51D_valueSeparator</code> changed to <code>51D_value_separator</code>.</li>
</ul>
</li>
</ul>
<p>New in V4:</p><ul>
<li><code>51D_drift</code></li>
<li><code>51D_difference</code></li>
<li><code>51D_allow_unmatched</code></li>
<li><code>51D_use_performance_graph</code></li>
<li><code>51D_use_predictive_graph</code></li>
<li><code>51D_get_javascript_single</code></li>
<li><code>51D_get_javascript_all</code></li>
<li><code>51D_set_resp_headers</code></li>
</ul>
<p>New requirements in V4:</p><ul>
<li>Building V4 module requires a compiler that support C11.</li>
<li>libatomic1</li>
</ul>
<p>Changes in behaviour:</p><ul>
<li><code>51D_match_all</code> also takes evidence from query string and cookie.<ul>
<li>Evidence input from query string takes precedence over header evidence.<ul>
<li>For example, if <code>User-Agent</code> is supplied via query string, the value will be used instead of the header <code>User-Agent</code>.</li>
</ul>
</li>
<li>Properties that are overridable can now be overridden by value supplied as input from cookie and query string. Further reads:</li>
</ul>
</li>
<li><a class="el" href="_device_detection__other_integrations__nginx.html">Nginx Integration</a>  </div>   <div class="c-tabgroup__main" data-lang="varnish" style="display:none;"> </li>
</ul>
<p>Varnish module comes only with an On-Premise version. You will need to get the On-Premise version of the Varnish API from <a href="https://github.com/51Degrees/device-detection-varnish">GitHub</a>.</p>
<p>The implementation of 51Degrees Device Detection V4 module is based on the V3 version and the migration process from V3 to V4 is straightforward. Existing V3 customers can build and use V4 in a similar way as V3. Please make sure to obtain a V4 Hash data file using 51Degrees <a class="el" href="_services__distributor.html">Distributor</a> (License Key is required, check <a href="https://51degrees.com/pricing">pricing</a> page) and be aware of the changes described below.</p>
<p>Removed in V4:</p><ul>
<li>V4 version supports only one method of detection which is Hash.<ul>
<li>Building V4 module is done as below without specifying the detection method: <div class="c-code__block c-code__block--outline"><div class="c-code__line">./autogen.sh</div><div class="c-code__line">./configure --with-config=release|test --with-datafile=(optional)</div><div class="c-code__line">make</div><div class="c-code__line">sudo make install</div></div></li>
</ul>
</li>
<li>The following build options can now only be set as environment variables:<ul>
<li><code>VARNISHSRC</code></li>
<li><code>VMOD_DIR</code></li>
</ul>
</li>
<li>The following settings are removed:<ul>
<li><code>set_cache</code></li>
<li><code>set_pool</code></li>
</ul>
</li>
</ul>
<p>New in V4:</p><ul>
<li>The build <code>./configure</code> command can now be run with the following new flags:<ul>
<li><code>--with-config</code>: set whether <code>release</code> or <code>test</code> module should be built.</li>
<li><code>--with-datafile</code>: set the data file to be used with tests. This is only applicable when <code>--with-config</code> is set to <code>test</code>.</li>
</ul>
</li>
<li>The following new settings are available to be set before calling <code>fiftyonedegrees.start</code> in V4 in addition to <code>set_delimiter</code> and <code>set_properties</code>:<ul>
<li><code>set_performance_profile</code></li>
<li><code>set_drift</code></li>
<li><code>set_difference</code></li>
<li><code>set_max_concurrency</code></li>
<li><code>set_allow_unmatched</code></li>
<li><code>set_use_performance_graph</code></li>
<li><code>set_use_predictive_graph</code></li>
</ul>
</li>
<li>To support automatic requesting relevant User-Agent Client Hints, a new function <code>set_resp_headers</code> can be added to the <code>vcl_deliver</code> block. This only works with browsers that support User-Agent Client Hints. For device detection to work with User-Agent Client Hints, the function <code>match_all</code> should be used.</li>
</ul>
<p>New requirements in V4:</p><ul>
<li>Building V4 module requires a compiler that support C11.</li>
<li>libatomic1</li>
</ul>
<p>Further reads:</p><ul>
<li><a class="el" href="_device_detection__other_integrations__varnish.html">Varnish Integration</a>  </div> </li>
</ul>
<p> </div>  </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
