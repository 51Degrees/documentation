<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Concurrent Processing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_device_detection__features__concurrent_processing.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__index.html">Device Detection</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__features__index.html">Device Detection Features</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_device_detection__features__concurrent_processing.html">Concurrent Processing</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Concurrent Processing </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p>When using a <a class="el" href="_device_detection__features__performance_options.html">PerformanceProfile</a> that loads collections completely into memory, the API's ability to handle concurrent requests is only limited by the available hardware resources. However, when using a lower memory <a class="el" href="_device_detection__features__performance_options.html">PerformanceProfile</a> where collections are partially or fully read from file, consideration needs to be given to how many parallel threads will be accessing the <a class="el" href="_concepts__pipeline.html">Pipeline</a>.</p>
<p>See the <a href="https://github.com/51Degrees/specifications/blob/main/pipeline-specification/advanced-features/parallel-processing.md#">Specification</a> for more technical details.</p>
<h1 class="g-docs__section-heading">Detail</h1>
<p>For <a class="el" href="_device_detection__features__performance_options.html">PerformanceProfiles</a> such as <code>LowMemory</code> and <code>Balanced</code>, the concurrency is limited by the number of file handles available in the file pool. In most implementations, the default value for this is the number of cores available on the machine. If more threads than this will be used, the expected concurrency must be configured when creating the engine, so that the file pool is created with the correct size to handle the expected number of concurrent accesses.</p>
<p>The snippet below shows how to set this when creating the engine:  <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'java')">Java</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'node')">Node.js</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'php')">PHP</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'python')">Python</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'c')">C</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'cpp')">C++</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a tab to view language specific information on setting the concurrency. </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;">  In code: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var pipeline =  <span class="c-code__keyword">new</span> DeviceDetectionPipelineBuilder(loggerFactory)</div><div class="c-code__line">    .UseOnPremise(dataFile, <span class="c-code__keyword">null</span>, <span class="c-code__keyword">false</span>)</div><div class="c-code__line">    <span class="c-code__comment">// Set performance profile</span></div><div class="c-code__line">    .SetPerformanceProfile(PerformanceProfiles.LowMemory)</div><div class="c-code__line">    <span class="c-code__comment">// Set the expected concurrency</span></div><div class="c-code__line">    .SetConcurrency(threadCount)</div><div class="c-code__line">    .Build();</div></div><p> Or in config file: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">        {</div><div class="c-code__line">            &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">            &quot;BuildParameters&quot;: {</div><div class="c-code__line">                &quot;DataFile&quot;: &quot;51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">                &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;,</div><div class="c-code__line">                &quot;Concurrency&quot;: 30</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    ...</div><div class="c-code__line">    ]</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="java" style="display:none;">  In code: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">DeviceDetectionOnPremisePipelineBuilder builder = <span class="c-code__keyword">new</span> DeviceDetectionPipelineBuilder()</div><div class="c-code__line">    .useOnPremise(dataFileLocation, <span class="c-code__keyword">false</span>)</div><div class="c-code__line">    <span class="c-code__comment">// Set performance profile</span></div><div class="c-code__line">    .setPerformanceProfile(PerformanceProfiles.LowMemory)</div><div class="c-code__line">    <span class="c-code__comment">// Set the expected concurrency</span></div><div class="c-code__line">    .setConcurrency(threadCount)</div><div class="c-code__line">    .build();</div></div><p> Or in config file: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div><div class="c-code__line">    &lt;<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">DataFile</span>&gt;51<span class="c-code__keyword">Degrees-LiteV4.1.hash</span>&lt;/<span class="c-code__keywordtype">DataFile</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">PerformanceProfile</span>&gt;<span class="c-code__keyword">LowMemory</span>&lt;/<span class="c-code__keywordtype">PerformanceProfile</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">Concurrency</span>&gt;30&lt;/<span class="c-code__keywordtype">Concurrency</span>&gt;</div><div class="c-code__line">            &lt;/<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuilderName</span>&gt;<span class="c-code__keyword">DeviceDetectionHashEngine</span>&lt;/<span class="c-code__keywordtype">BuilderName</span>&gt;</div><div class="c-code__line">        &lt;/<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">        ...</div><div class="c-code__line">    &lt;/<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">&lt;/<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="node" style="display:none;">  In code: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">const pipeline = new DeviceDetectionOnPremisePipelineBuilder({</div><div class="c-code__line">    dataFile: datafile,</div><div class="c-code__line">    performanceProfile: &#39;LowMemory&#39;,</div><div class="c-code__line">    concurrency: threadCount</div><div class="c-code__line">}).build();</div></div><p> Or in config file: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">        {</div><div class="c-code__line">            &quot;elementName&quot;: &quot;deviceDetectionOnPremise&quot;,</div><div class="c-code__line">            &quot;elementParameters&quot;: {</div><div class="c-code__line">                &quot;performanceProfile&quot;: &quot;LowMemmory&quot;,</div><div class="c-code__line">                &quot;dataFilePath&quot;: &quot;51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">                &quot;concurrency&quot;: 30</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">        ...</div><div class="c-code__line">    ]</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="php" style="display:none;">  For PHP, the concurrency options is set in the php.ini file. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">extension=/usr/lib/php/20170718/FiftyOneDegreesHashEngine.so</div><div class="c-code__line">FiftyOneDegreesHashEngine.data_file=/path to your file/51Degrees-LiteV4.1.hash</div><div class="c-code__line">FiftyOneDegreesHashEngine.performance_profile=LowMemory</div><div class="c-code__line">FiftyOneDegreesHashEngine.concurrency=30</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="python" style="display:none;">  In code: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">pipeline = DeviceDetectionOnPremisePipelineBuilder(</div><div class="c-code__line">    data_file_path = data_file, </div><div class="c-code__line">    performance_profile = <span class="c-code__stringliteral">&#39;LowMemory&#39;</span>, </div><div class="c-code__line">    concurrency = thread_count).build()</div></div><p> Or in config file: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">        {</div><div class="c-code__line">            &quot;elementName&quot;: &quot;DeviceDetectionOnPremise&quot;,</div><div class="c-code__line">            &quot;elementPath&quot;: &quot;fiftyone_devicedetection_onpremise.devicedetection_onpremise&quot;,</div><div class="c-code__line">            &quot;elementParameters&quot;: {</div><div class="c-code__line">                &quot;data_file_path&quot;: &quot;51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">                &quot;performance_profile&quot;: &quot;LowMemory&quot;,</div><div class="c-code__line">                &quot;concurrency&quot;: 30</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    ...</div><div class="c-code__line">    ]</div><div class="c-code__line">}</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="c" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">ConfigHash config = HashLowMemoryConfig;</div><div class="c-code__line"></div><div class="c-code__line">config.strings.concurrency = threadCount;</div><div class="c-code__line">config.properties.concurrency = threadCount;</div><div class="c-code__line">config.values.concurrency = threadCount;</div><div class="c-code__line">config.profiles.concurrency = threadCount;</div><div class="c-code__line">config.nodes.concurrency = threadCount;</div><div class="c-code__line">config.profileOffsets.concurrency = threadCount;</div><div class="c-code__line">config.maps.concurrency = threadCount;</div><div class="c-code__line">config.components.concurrency = threadCount;</div><div class="c-code__line"></div><div class="c-code__line">StatusCode status = HashInitManagerFromFile(</div><div class="c-code__line">    &amp;manager,</div><div class="c-code__line">    &amp;dataSetConfig,</div><div class="c-code__line">    &amp;properties,</div><div class="c-code__line">    dataFileLocation,</div><div class="c-code__line">    exception);</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="cpp" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">ConfigHash* config = <span class="c-code__keyword">new</span> ConfigHash();</div><div class="c-code__line">config-&gt;setLowMemory();</div><div class="c-code__line">config-&gt;setConcurrency(threadCount);</div><div class="c-code__line"></div><div class="c-code__line">EngineHash *engine =</div><div class="c-code__line">    <span class="c-code__keyword">new</span> DeviceDetection::Hash::EngineHash(</div><div class="c-code__line">    dataFilePath,</div><div class="c-code__line">    config,</div><div class="c-code__line">    properties);</div></div><p>  </div>   </div>  </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
