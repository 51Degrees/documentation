<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: Building from Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_concepts__configuration__builders__build_from_configuration.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_concepts__index.html">Concepts</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_concepts__configuration__index.html">Configuration</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_concepts__configuration__builders__index.html">Builders</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_concepts__configuration__builders__build_from_configuration.html">Building from Configuration</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">Building from Configuration </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">Introduction</h1>
<p>Rather than setting all build options and <a class="el" href="_concepts__flow_elements__flow_element.html">flow elements</a> explicitly in code form, it is often preferable to make the <a class="el" href="_concepts__pipeline.html">Pipeline</a> configurable without recompiling. A <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> allows this via its 'BuildFromConfiguration' method.</p>
<h1 class="g-docs__section-heading">Usage</h1>
<p>A configuration can be parsed manually from XML, JSON, or any other source and given to a <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a>. Alternatively, in <a class="el" href="_features__web_integration.html">web integrations</a>, a configuration file is loaded automatically.</p>
<p>Note, the possible format of the configuration file varies greatly between languages, with some languages having many options and others only having one. Where possible, we recommend using JSON as the simplest and most transferable configuration format; JSON is also supported by the PHP and Node.js bindings, where XML is not.</p>
<h2>Parsing XML</h2>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'java')">Java</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a language for an example of parsing XML. </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var config = <span class="c-code__keyword">new</span> ConfigurationBuilder()</div><div class="c-code__line">    .AddXmlFile(<span class="c-code__stringliteral">&quot;configuration.xml&quot;</span>)</div><div class="c-code__line">    .Build();</div><div class="c-code__line">PipelineOptions options = <span class="c-code__keyword">new</span> PipelineOptions();</div><div class="c-code__line">config.Bind(<span class="c-code__stringliteral">&quot;PipelineOptions&quot;</span>, options);</div><div class="c-code__line"></div><div class="c-code__line">IPipeline pipeline = <span class="c-code__keyword">new</span> PipelineBuilder(loggerFactory)</div><div class="c-code__line">    .BuildFromConfiguration(options);</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="java" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">File file = <span class="c-code__keyword">new</span> File(<span class="c-code__stringliteral">&quot;configuration.xml&quot;</span>);</div><div class="c-code__line">Unmarshaller unmarshaller = JAXBContext</div><div class="c-code__line">    .newInstance(PipelineOptions.class)</div><div class="c-code__line">    .createUnmarshaller();</div><div class="c-code__line">PipelineOptions options = (PipelineOptions) unmarshaller.unmarshal(file);</div><div class="c-code__line"></div><div class="c-code__line">Pipeline pipeline = <span class="c-code__keyword">new</span> PipelineBuilder(loggerFactory)</div><div class="c-code__line">    .buildFromConfiguration(options);</div></div><p>  </div>   </div> </p>
<h2>Parsing JSON</h2>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'php')">PHP</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'node')">Node.js</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a language for an example of parsing JSON. </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var config = <span class="c-code__keyword">new</span> ConfigurationBuilder()</div><div class="c-code__line">    .AddJsonFile(<span class="c-code__stringliteral">&quot;configuration.json&quot;</span>)</div><div class="c-code__line">    .Build();</div><div class="c-code__line">PipelineOptions options = <span class="c-code__keyword">new</span> PipelineOptions();</div><div class="c-code__line">config.Bind(<span class="c-code__stringliteral">&quot;PipelineOptions&quot;</span>, options);</div><div class="c-code__line"></div><div class="c-code__line">IPipeline pipeline = <span class="c-code__keyword">new</span> PipelineBuilder(loggerFactory)</div><div class="c-code__line">    .BuildFromConfiguration(options);</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="php" style="display:none;">  </p><pre class="fragment">use fiftyone\pipeline\core\PipelineBuilder;
$builder = new PipelineBuilder();
$pipeline = $builder-&gt;buildFromConfig($configFile)-&gt;build();
</pre><p>  </div>   <div class="c-tabgroup__main" data-lang="node" style="display:none;">  </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">const pipeline = new FiftyOneDegreesGeoLocation.GeoLocationPipelineBuilder({resourceKey:localResourceKey});</div><div class="c-code__line">pipeline.buildFromConfigurationFile(configFilePath);</div></div><p>  </div>   </div> </p>
<h1 class="g-docs__section-heading">Example configuration</h1>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'XML')">XML</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'JSON')">JSON</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a file format to view an example configuration. </div>   <div class="c-tabgroup__main" data-lang="XML" style="display:none;">  Configure a <a class="el" href="_concepts__pipeline.html">Pipeline</a> with a <a class="el" href="_concepts__flow_elements__flow_element.html">flow element</a> named 'MyElement' with a build parameter, and set the <a class="el" href="_concepts__pipeline.html">Pipeline</a> to <a class="el" href="_concepts__configuration__builders__pipeline_builder.html#Concepts_Configuration_Builders_PipelineBuilder_SuppressProcessExceptions">suppress process exceptions</a>. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div><div class="c-code__line">    &lt;<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuilderName</span>&gt;<span class="c-code__keyword">MyElementBuilder</span>&lt;/<span class="c-code__keywordtype">BuilderName</span>&gt;</div><div class="c-code__line">            &lt;<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">                &lt;<span class="c-code__keywordtype">MyBuildParameter</span>&gt;<span class="c-code__keyword">a</span> <span class="c-code__keyword">value</span> <span class="c-code__keyword">for</span> <span class="c-code__keyword">the</span> <span class="c-code__keyword">element</span>&lt;/<span class="c-code__keywordtype">MyBuildParameter</span>&gt;</div><div class="c-code__line">            &lt;/<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">        &lt;/<span class="c-code__keywordtype">Element</span>&gt;</div><div class="c-code__line">    &lt;/<span class="c-code__keywordtype">Elements</span>&gt;</div><div class="c-code__line">    &lt;<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">        &lt;<span class="c-code__keywordtype">SuppressProcessExceptions</span>&gt;<span class="c-code__keyword">true</span>&lt;/<span class="c-code__keywordtype">SuppressProcessExceptions</span>&gt;</div><div class="c-code__line">    &lt;/<span class="c-code__keywordtype">BuildParameters</span>&gt;</div><div class="c-code__line">&lt;/<span class="c-code__keywordtype">PipelineOptions</span>&gt;</div></div><p>  </div>   <div class="c-tabgroup__main" data-lang="JSON" style="display:none;">  Configure a <a class="el" href="_concepts__pipeline.html">Pipeline</a> with a <a class="el" href="_concepts__flow_elements__flow_element.html">flow element</a> named 'MyElement' with a build parameter, and set the <a class="el" href="_concepts__pipeline.html">Pipeline</a> to <a class="el" href="_concepts__configuration__builders__pipeline_builder.html#Concepts_Configuration_Builders_PipelineBuilder_SuppressProcessExceptions">suppress process exceptions</a>.</p>
<p>Note that for use in node.js, <code>BuilderName</code> and <code>BuilderParameters</code> should be replaced by <code>elementName</code> and <code>elementParameters</code>. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;MyElementBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;MyBuildParameter&quot;: &quot;a value for the element&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ],</div><div class="c-code__line">    &quot;BuildParameters&quot;: {</div><div class="c-code__line">      &quot;SuppressProcessExceptions&quot;: true</div><div class="c-code__line">    }</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><p>  </div>   </div> </p>
<h1 class="g-docs__section-heading">Rules for building from a configuration file</h1>
<p>The core <b>build from configuration</b> logic ultimately calls the same configuration methods, on the same builders as the developer does if they configure the <a class="el" href="_concepts__pipeline.html">Pipeline</a> in code.</p>
<p>There are several rules that govern how a value in a configuration file is mapped to a builder or configuration method:</p>
<h2>Element builder names</h2>
<p>The element builder name is used to determine the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a> that we want to use. Each of the following is tried in turn to find a builder that matches the supplied name:</p>
<ol type="1">
<li>Case insensitive match on type name (e.g. 'MyElementBuilder' matches a type with that name).</li>
<li>Case insensitive match on type name suffixed with 'builder' (e.g. 'MyElement' matches a type called 'MyElementBuilder').</li>
<li>Where the language allows it, match on some <a class="el" href="_concepts__configuration__builders__build_from_configuration.html#Concepts_Configuration_Builders_BuildFromConfiguration_AlternativeName">alternative name</a> for the builder.</li>
</ol>
<h2>Element build parameters</h2>
<p>The key value of each entry in the 'build parameters' list associated with each <a class="el" href="_concepts__flow_elements__flow_element.html">element</a> is used to determine the method to call on the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a>. Each of the following is tried in turn to find a method that matches the supplied name:</p>
<ol type="1">
<li>Case insensitive match on method name (e.g. 'SetCacheSize' matches a method with that name).</li>
<li>Case insensitive match on method name prefixed with 'set' (e.g. 'CacheSize' matches a method called 'SetCacheSize').</li>
<li>Where the language allows it, match on some <a class="el" href="_concepts__configuration__builders__build_from_configuration.html#Concepts_Configuration_Builders_BuildFromConfiguration_AlternativeName">alternative name</a> for the method.</li>
</ol>
<p>The value part of each entry in the 'build parameters' list is then passed to the matching method as a parameter. For strongly-types languages, this may also involve parsing a string value from the configuration into the required type.</p>
<p>If there are any build parameters for which a method cannot be found, they will be used to set parameters on the 'Build' method once configuration is complete. In this case, a simple case-insensitive match is performed to determine the parameter value to set.</p>
<h2>Pipeline build parameters</h2>
<p><a class="el" href="_concepts__pipeline.html">Pipeline</a> build parameters work in the same way as element build parameters but they are used to call configuration methods on the <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> instead of the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a>.</p>
<p>See above for all the rules governing this.</p>
<h2>Alternative naming details<a class="anchor" id="Concepts_Configuration_Builders_BuildFromConfiguration_AlternativeName"></a></h2>
<p>Some languages have a mechanism for specifying alternative names for builders and methods. These can be used to match against supplied configuration options.</p>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'java')">Java</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a language for information of specifying an alternative name for element builders and configuration methods. </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;">  The AlternateNameAttribute can be used to decorate <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a> classes as well as configuration methods on an <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a>. This can be used to specify one or more other names to match on when building from configuration.  </div>   <div class="c-tabgroup__main" data-lang="java" style="display:none;">  The <code>ElementBuilder(alternateName)</code> attribute can be used to decorate <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a> classes. This can be used to specify one or more other names to match when buiding from configuration.  </div>   </div> </p>
<h1 class="g-docs__section-heading">Internals</h1>
<p>The exact internal mechanics of the <b>builder</b> will depend on the language being used. Wherever possible, the rules for mapping are consistent between languages but this cannot always be achieved.</p>
<p> <div class="c-tabgroup">   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'dotnet')">C#</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'php')">PHP</button>   <button class="b-btn b-btn--tab" onclick="showSnippet(this,'node')">Node.js</button>   <div class="c-tabgroup__main" data-lang="none" style="display:block;">  Select a language for more details of the internals of <b>build from configuration</b>. </div>   <div class="c-tabgroup__main" data-lang="dotnet" style="display:none;">  In .NET, <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> relies on reflection to find the correct builder to build the <a class="el" href="_concepts__flow_elements__flow_element.html">flow elements</a> required by the configuration. For this reason, it is necessary for the libraries that contain the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builders</a> for each <a class="el" href="_concepts__flow_elements__flow_element.html">flow element</a> to be loaded. This can be done in a number of ways:</p><ul>
<li>loading the library by calling a method in code;</li>
<li>adding a library to a config file to be loaded;</li>
</ul>
<p>For example: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">Assembly.Load(<span class="c-code__stringliteral">&quot;FiftyOne.DeviceDetection.Hash.Engine.OnPremise&quot;</span>);</div></div><p>Additionally, the <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> will need to know how to supply any dependencies required by the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builders</a> it creates.</p>
<p>By default, the <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> will call a constructor on <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a> that takes an ILoggerFactory if one is available. If not, it will call the default constructor - if one is available.</p>
<p>If neither are available then the <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> will be unable to create the <a class="el" href="_concepts__configuration__builders__element_builder.html">element builder</a>.</p>
<p>This can be resolved by passing an IServiceProvider to the <a class="el" href="_concepts__configuration__builders__pipeline_builder.html">pipeline builder</a> on construction that is populated with instances of the services that <a class="el" href="_concepts__configuration__builders__element_builder.html">element builders</a> will require.  </div>   <div class="c-tabgroup__main" data-lang="php" style="display:none;">  PHP will load elements named in <code>BuilderName</code> as if they were specified in a <code>use</code> statement, so for example:</p>
<pre class="fragment">"BuilderName": "fiftyone\\pipeline\\cloudrequestengine\\CloudRequestEngine"
</pre><p> </div>   <div class="c-tabgroup__main" data-lang="node" style="display:none;">  Node will load elements named in <code>ElementName</code> as if they were specified in a <code>require</code> statement, so for example:</p>
<p>"ElementName": "fiftyone.pipeline.cloudrequestengine"  </div>   </div>  </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
