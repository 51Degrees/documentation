<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees API Documentation: UAParser.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees API Documentation
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_other_integrations__u_a_parser.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="PageDoc"><div class="g-docs__header">
<div class="c-breadcrumb">
  <ul class="c-breadcrumb">
<li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_other_integrations__index.html">Other Integrations</a></li><li class="c-breadcrumb__item"><a class="c-breadcrumb__link" href="_other_integrations__u_a_parser.html">UAParser.js</a></li>  </ul>
</div>
<h2 class="g-docs__page-title">UAParser.js </h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<section class="g-docs__section"><h1 class="g-docs__section-heading">51Degrees UAParser</h1>
<p>We've forked the popular UAParser.js library (which relies solely on a <a href="https://51degrees.com/blog/countdown-to-gday-phase-6-reduced-mobile-tablet-ua">deprecated User-Agent</a>) to create the <a href="https://github.com/51Degrees/ua-parser-js">51Degrees UAParser</a>, which has support for both User-Agents and User-Agent Client Hints (UA-CH).</p>
<p>Depending on your environment, you may need to delegate UA-CH to the third-party cloud.51degrees.com domain. There are two ways to tell the browser that it is allowed to pass the Client Hints to the third-party domain:</p>
<ul>
<li>Setting the Accept-CH and Permissions-Policy HTTP response headers when serving the page.</li>
<li>Adding the <code>&lt;meta http-equiv="Delegate-CH"&gt;</code> tag in the page head.</li>
</ul>
<p>You can find out more on which method is more suitable for your environment via <a href="https://51degrees.com/blog/introducing-51degrees-uaparser">this UAParser blog</a>. You can also see the 51Degrees UAParser in action with this <a href="https://51degrees.github.io/ua-parser-js/">UAParser demonstration page.</a></p>
<p><a class="anchor" id="Download_UAParser"></a></p><h2>Download the 51D UAParser</h2>
<p>The packages are available via:</p>
<ul>
<li><a href="https://www.npmjs.com/package/@51degrees/ua-parser-js">npm</a></li>
<li><a href="https://github.com/51Degrees/ua-parser-js">GitHub</a></li>
<li><a href="https://www.jsdelivr.com/package/npm/@51degrees/ua-parser-js">jsDelivr</a></li>
</ul>
<h2>Migrating from UAParser.js to 51Degrees UAParser</h2>
<h3>Creating a Resource Key</h3>
<p>Before integrating 51Degrees UAParser, you need to register and configure a 51Degrees Resource Key using the <a href="https://configure.51degrees.com/">Cloud Configurator</a>. The Configurator tool allows you to choose the device properties you would like to get as a result of the call to UAParser. Follow the <a class="el" href="_concepts__configurator.html">Configurator explanation</a> for more detail on how to create a Resource Key.</p>
<p>We recommend following this URL <a href="https://configure.51degrees.com/S6fGMDKw">https://configure.51degrees.com/S6fGMDKw</a> to create a Resource Key, as it contains the minimum recommended properties that you will need for the UAParser to work.</p>
<p>The minimum recommended properties to include in your Resource Key are:</p><ul>
<li>IsMobile</li>
<li>HardwareVendor</li>
<li>HardwareModel</li>
<li>HardwareName</li>
<li>PlatformVendor</li>
<li>PlatformName</li>
<li>PlatformVersion</li>
<li>LayoutEngine</li>
<li>BrowserVendor</li>
<li>BrowserName</li>
<li>BrowserVersion</li>
<li>JavascriptHardwareProfile</li>
<li>DeviceType</li>
<li>SetHeaderBrowserAccept-CH</li>
<li>SetHeaderHardwareAccept-CH</li>
<li>SetHeaderPlatformAccept-CH</li>
</ul>
<p>The majority of the recommended properties are the equivalent to the properties that the original UAParser.js returned. However, the 51Degrees UAParser requires additional properties for accurate device detection. JavascriptHardwareProfile is needed for <a class="el" href="_device_detection__features__apple_detection.html">reliable detection of Apple devices</a>, and the trio of Accept-CH properties are needed for <a class="el" href="_device_detection__features__u_a_c_h__overview.html">User-Agent Client Hints detection</a>.</p>
<h2>Migrating client-side code</h2>
<p>To migrate from the original ua-parser-js, you probably had the page code similar to the below:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;!doctype html&gt;</div><div class="c-code__line">    &lt;html&gt;</div><div class="c-code__line">        &lt;head&gt;</div><div class="c-code__line">            &lt;script src=&quot;ua-parser.min.js&quot;&gt;&lt;/script&gt;</div><div class="c-code__line">            &lt;script&gt;</div><div class="c-code__line">                let result = UAParser();</div><div class="c-code__line">                console.log(result);</div><div class="c-code__line">            &lt;/script&gt;</div><div class="c-code__line">        &lt;/head&gt;</div><div class="c-code__line">    &lt;body&gt;</div><div class="c-code__line">    &lt;/body&gt; </div><div class="c-code__line">    &lt;/html&gt;</div></div><p>To migrate this code to use 51Degrees UAParser:</p>
<ol type="1">
<li><a class="el" href="_other_integrations__u_a_parser.html#Download_UAParser">Download the 51Degrees UAParser package</a></li>
<li>We need to either use Accept-CH and Permissions-Policy headers or add a Delegate-CH meta tag within the <code>&lt;head&gt;</code> element. We chose the latter in the below migrated code snippet example.</li>
<li>Change the script import statement to use the path to the new package in the src attribute or use a CDN link.</li>
<li>The new 51Degrees UAParser is inherently asynchronous, thus UAParser is a promise. We prefer resolving promises using the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">await</a> keyword â€“ in order to use the top-level await, we must set the script <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">type="module" ()</a>. It is possible, however, to use the UAParser without await, calling then () instead.</li>
<li>Here is the code to obtain the result object, notice the await keyword and the Resource Key: <code>let result = await UAParser("&lt;your resource key&gt;");</code></li>
<li>The code below obtaining the result can stay the same, but if you had additional properties configured for this Resource Key, you can access them directly (using lowercase key names) inside the result.device object.</li>
</ol>
<p>The migrated code snippet looks like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;!doctype html&gt; </div><div class="c-code__line">    &lt;html&gt; </div><div class="c-code__line">        &lt;head&gt; </div><div class="c-code__line">            &lt;meta http-equiv=&quot;Delegate-CH&quot; content=&quot;Sec-CH-UA-Model https://cloud.51degrees.com; Sec-CH-UA https://cloud.51degrees.com; Sec-CH-UA-Arch https://cloud.51degrees.com; Sec-CH-UA-Full-Version https://cloud.51degrees.com; Sec-CH-UA-Mobile https://cloud.51degrees.com; Sec-CH-UA-Platform https://cloud.51degrees.com; Sec-CH-UA-Platform-Version https://cloud.51degrees.com&quot; /&gt; </div><div class="c-code__line">            &lt;script src=&quot;ua-parser.min.js&quot;&gt;&lt;/script&gt; </div><div class="c-code__line">            &lt;script type=&quot;module&quot;&gt; </div><div class="c-code__line">               let result = await UAParser(&quot;resource key&quot;);  </div><div class="c-code__line">               console.log(result); </div><div class="c-code__line">            &lt;/script&gt; </div><div class="c-code__line">        &lt;/head&gt; </div><div class="c-code__line">        &lt;body&gt; </div><div class="c-code__line">        &lt;/body&gt; </div><div class="c-code__line">    &lt;/html&gt;</div></div><p>Alternatively, if the server adds Accept-CH and Permissions-Policy response headers, the snippet becomes even simpler as you can omit the Delegate-CH meta tag.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">&lt;!doctype html&gt; </div><div class="c-code__line">    &lt;html&gt;</div><div class="c-code__line">        &lt;head&gt; </div><div class="c-code__line">            &lt;script src=&quot;https://cdn.jsdelivr.net/npm/@51degrees/ua-parser-js&quot;&gt;&lt;/script&gt; </div><div class="c-code__line">            &lt;script type=&quot;module&quot;&gt; </div><div class="c-code__line">                let result = await UAParser(&quot;resource key&quot;);  </div><div class="c-code__line">                console.log(result); </div><div class="c-code__line">            &lt;/script&gt; </div><div class="c-code__line">        &lt;/head&gt; </div><div class="c-code__line">        &lt;body&gt; </div><div class="c-code__line">        &lt;/body&gt; </div><div class="c-code__line">    &lt;/html&gt; </div></div><h2>Migrating server-side code</h2>
<p>A common scenario on the server is to receive a User-Agent as a request header and pass it to the UAParser to recognize the device. The Node.js server code could look something like this:</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">var http = require(&#39;http&#39;); </div><div class="c-code__line">var parser = require(&#39;ua-parser-js&#39;); </div><div class="c-code__line"> </div><div class="c-code__line">http.createServer(function (req, res) { </div><div class="c-code__line">    // parse user-agent header </div><div class="c-code__line">    var result = parser(req.headers[&#39;user-agent&#39;]); </div><div class="c-code__line">    res.end(JSON.stringify(result, null, &#39; &#39;)); </div><div class="c-code__line">}) </div><div class="c-code__line">.listen(80, &#39;0.0.0.0&#39;);</div></div><p>Here is what we need to change to migrate this to use 51Degrees UAParser:</p>
<ol type="1">
<li>We want to use a HTTPS server instead of HTTP so that the browser would send us User-Agent Client Hints (as UA-CH are only sent over HTTPS connections)</li>
<li>The package name in the require statement should be changed to @51degrees/ua-parser-js.</li>
<li>The function passed to the server should now be marked async, as we are going to use await inside it.</li>
<li>The parser call should be prepended with await.</li>
<li>The parser call now takes the Resource Key and the request header map as a parameter.</li>
</ol>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">        // the self-signed certificate for the test environment </div><div class="c-code__line">            var fs = require(&#39;fs&#39;); </div><div class="c-code__line">            var options = { </div><div class="c-code__line">                key: fs.readFileSync(&#39;.cert/key.pem&#39;), </div><div class="c-code__line">                cert: fs.readFileSync(&#39;.cert/cert.pem&#39;) </div><div class="c-code__line">            };</div><div class="c-code__line"></div><div class="c-code__line">        // the new package name </div><div class="c-code__line">            const UAParser = require(&quot;@51degrees/ua-parser-js&quot;); </div><div class="c-code__line">            var https = require(&#39;https&#39;);</div><div class="c-code__line"></div><div class="c-code__line">        // note the async function </div><div class="c-code__line">            https.createServer(options, async function (req, res) { </div><div class="c-code__line">            // note the await keyword and parameters </div><div class="c-code__line">                let result = await UAParser(&quot;your resource key&quot;, req.headers); </div><div class="c-code__line">                res.end(&quot;</div><div class="c-code__line">51Degrees:</div><div class="c-code__line">&quot; + JSON.stringify(result, null, &#39; &#39;) + &quot;</div><div class="c-code__line">                &quot;);</div><div class="c-code__line">            })</div><div class="c-code__line">            .listen(443, &#39;0.0.0.0&#39;);</div></div><p>Now we assume that this would be a secondary call to the server from within the page that has already been rendered and had an Accept-CH header in the response that listed all the necessary User-Agent Client Hints. The Accept-CH header in the original page would make it send the Client Hints in all subsequent requests to the same origin. This feature is called the Accept-CH cache.</p>
<p>Here is a quick and dirty example where we'll show how to ask the browser to immediately send the User-Agent Client Hints by setting two response headers: Accept-CH and Critical-CH. The latter tells the browser to immediately come back with the Client Hints if it did not send them on the first attempt, so it starts another request before loading the response body.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">        // the self-signed certificate for the test environment </div><div class="c-code__line">        var fs = require(&#39;fs&#39;); </div><div class="c-code__line">        var options = { </div><div class="c-code__line">            key: fs.readFileSync(&#39;.cert/key.pem&#39;), </div><div class="c-code__line">            cert: fs.readFileSync(&#39;.cert/cert.pem&#39;) </div><div class="c-code__line">        }; </div><div class="c-code__line"> </div><div class="c-code__line">        // the new package name </div><div class="c-code__line">        const UAParser = require(&quot;@51degrees/ua-parser-js&quot;); </div><div class="c-code__line">        var https = require(&#39;https&#39;); </div><div class="c-code__line"> </div><div class="c-code__line">        // note the async function </div><div class="c-code__line">        https.createServer(options, async function (req, res) { </div><div class="c-code__line">        // note the await keyword and parameters </div><div class="c-code__line">        let result = await UAParser(&quot;your resource key&quot;, req.headers); </div><div class="c-code__line"> </div><div class="c-code__line">        ch = &#39;Sec-CH-UA, Sec-CH-UA-Arch, Sec-CH-Bitness, Sec-CH-UA-Full-Version, \ </div><div class="c-code__line">        Sec-CH-UA-Full-Version-List, Sec-CH-UA-Mobile, Sec-CH-UA-Model, \ </div><div class="c-code__line">        Sec-CH-UA-Platform, Sec-CH-UA-Platform-Version, Sec-CH-UA-WoW64&#39; </div><div class="c-code__line"> </div><div class="c-code__line">        res.setHeader(&#39;Critical-CH&#39;,ch) </div><div class="c-code__line">        res.setHeader(&#39;Accept-CH&#39;, ch) </div><div class="c-code__line"> </div><div class="c-code__line">        res.end(&quot;</div><div class="c-code__line">51Degrees:</div><div class="c-code__line">&quot; + JSON.stringify(result, null, &#39; &#39;) + &quot;&quot;); </div><div class="c-code__line">        }) </div><div class="c-code__line">        .listen(443, &#39;0.0.0.0&#39;); </div></div><h2>Live code demo</h2>
<p>We hosted a live code demo of the 51Degrees UAParser during a webinar.</p>
<p> 
<iframe src="https://player.vimeo.com/video/805500329" width="640" height="360" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
 </p>
</section></div><!-- PageDoc -->
</div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
